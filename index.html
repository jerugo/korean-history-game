<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ğŸ¯ í•œêµ­ì‚¬ íƒ€ì„ì–´ë“œë²¤ì²˜ 2.0</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--primary:#FF6B6B;--secondary:#4ECDC4;--accent:#FFE66D;--bg:#FFF8F0;--card:#FFFFFF;--text:#2D3436;--correct:#00B894;--wrong:#E17055;--star:#FDCB6E;--lock:#B2BEC3;--shadow:0 4px 15px rgba(0,0,0,0.1);--gradient:linear-gradient(135deg,#667eea 0%,#764ba2 100%)}

@font-face{font-family:'emoji';src:local('Apple Color Emoji'),local('Segoe UI Emoji'),local('Noto Color Emoji')}
body{font-family:-apple-system,BlinkMacSystemFont,'Malgun Gothic','ë§‘ì€ ê³ ë”•',sans-serif;background:var(--bg);color:var(--text);min-height:100dvh;overflow-x:hidden}

/* Enhanced Animations */
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes pop{0%{transform:scale(0)}50%{transform:scale(1.2)}100%{transform:scale(1)}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}
@keyframes starBurst{0%{transform:scale(0) rotate(0deg);opacity:0}50%{opacity:1}100%{transform:scale(1) rotate(360deg);opacity:1}}
@keyframes starFall{0%{transform:translateY(-50px) scale(0);opacity:1}100%{transform:translateY(200px) scale(1);opacity:0}}
@keyframes float{0%,100%{transform:translateY(0) rotate(-3deg)}50%{transform:translateY(-15px) rotate(3deg)}}
@keyframes slideUp{from{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-10px)}60%{transform:translateY(-5px)}}
@keyframes glow{0%{box-shadow:0 0 5px var(--correct)}50%{box-shadow:0 0 25px var(--correct),0 0 35px var(--correct)}100%{box-shadow:0 0 5px var(--correct)}}
@keyframes wrongShake{0%,100%{transform:translateX(0) rotate(0deg)}25%{transform:translateX(-10px) rotate(-2deg)}75%{transform:translateX(10px) rotate(2deg)}}
@keyframes levelUp{0%{transform:scale(0.8) rotate(-10deg);opacity:0}50%{transform:scale(1.1) rotate(5deg);opacity:1}100%{transform:scale(1) rotate(0deg);opacity:1}}
@keyframes fireWork{0%{transform:scale(0);opacity:1}100%{transform:scale(2);opacity:0}}
@keyframes comboCounter{0%{transform:scale(1)}50%{transform:scale(1.3) rotate(5deg)}100%{transform:scale(1)}}
@keyframes characterWave{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}

.screen{display:none;flex-direction:column;align-items:center;padding:20px;min-height:100dvh;animation:fadeIn .4s}
.screen.active{display:flex}

h1{font-size:1.8rem;text-align:center}
h2{font-size:1.4rem;text-align:center;margin-bottom:12px}

.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 28px;border:none;border-radius:16px;font-size:1.1rem;font-weight:700;cursor:pointer;transition:all .2s;box-shadow:var(--shadow);font-family:inherit;-webkit-tap-highlight-color:transparent;position:relative;overflow:hidden}
.btn:hover{transform:translateY(-2px)}
.btn:active{transform:scale(.95)}
.btn-primary{background:linear-gradient(135deg,var(--primary),#ee5a24);color:#fff}
.btn-secondary{background:linear-gradient(135deg,var(--secondary),#00b894);color:#fff}
.btn-accent{background:linear-gradient(135deg,var(--accent),#f9ca24);color:var(--text)}
.btn-outline{background:var(--card);color:var(--text);border:2px solid #dfe6e9}
.btn-sm{padding:10px 18px;font-size:.95rem;border-radius:12px}
.card{background:var(--card);border-radius:20px;padding:20px;box-shadow:var(--shadow);width:100%;max-width:400px}

/* Main Screen with Character */
#main-screen{justify-content:center;gap:20px;text-align:center}
.main-character{font-size:5rem;animation:characterWave 3s ease-in-out infinite;margin:20px 0}
.title-area{animation:float 4s ease-in-out infinite}
.title-emoji{font-size:4rem;display:block;margin-bottom:8px}
.title-sub{font-size:1rem;color:#636e72;margin-top:4px}
.main-btns{display:flex;flex-direction:column;gap:12px;width:100%;max-width:320px}
.main-btns .btn{width:100%}

.player-info{display:flex;align-items:center;gap:10px;padding:12px 20px;background:var(--card);border-radius:16px;box-shadow:var(--shadow);font-size:.95rem;margin-bottom:12px}
.level-badge{background:linear-gradient(135deg,var(--accent),#f9ca24);padding:4px 12px;border-radius:20px;font-weight:700;font-size:.85rem}
.progress-stats{display:flex;gap:15px;font-size:.9rem;color:#636e72;margin-top:8px}

/* Stage Select Map Style */
.stage-map{display:flex;flex-direction:column;gap:8px;width:100%;max-width:450px;margin-top:12px;position:relative}
.stage-connector{height:25px;width:4px;background:linear-gradient(to bottom,var(--secondary),var(--primary));margin:0 auto;border-radius:2px;position:relative}
.stage-connector.locked{background:#ddd;opacity:0.5}
.stage-card{display:flex;align-items:center;gap:14px;padding:18px;border-radius:20px;background:var(--card);box-shadow:var(--shadow);cursor:pointer;transition:all .2s;position:relative;border:3px solid transparent}
.stage-card:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(0,0,0,0.15)}
.stage-card:active{transform:scale(.97)}
.stage-card.locked{opacity:.5;cursor:not-allowed;filter:grayscale(.8)}
.stage-card.completed{border-color:var(--correct)}
.stage-icon{font-size:2.8rem;width:60px;text-align:center}
.stage-info{flex:1}
.stage-info h3{font-size:1.1rem;margin-bottom:4px}
.stage-info p{font-size:.85rem;color:#636e72}
.stage-stats{font-size:.8rem;margin-top:6px;display:flex;gap:12px}
.stage-stars{color:var(--star);font-size:1.2rem;letter-spacing:2px}
.stage-progress{color:var(--secondary);font-weight:600}
.stage-lock{font-size:1.8rem;color:var(--lock)}

/* Quiz Screen Enhanced */
#quiz-screen{padding:16px;gap:12px}
.quiz-header{display:flex;justify-content:space-between;align-items:center;width:100%;max-width:400px}
.quiz-progress{font-size:.9rem;font-weight:700;color:#636e72}
.quiz-timer{display:flex;align-items:center;gap:4px;font-size:1rem;font-weight:700;padding:8px 16px;border-radius:12px;background:var(--card);box-shadow:var(--shadow);transition:all .3s}
.quiz-timer.warning{color:var(--wrong);animation:wrongShake .5s infinite}
.combo-counter{position:fixed;top:20px;right:20px;background:linear-gradient(45deg,#FF6B6B,#4ECDC4);color:white;padding:8px 16px;border-radius:20px;font-weight:bold;z-index:100;animation:comboCounter .5s;display:none}

.progress-bar{width:100%;max-width:400px;height:10px;background:#dfe6e9;border-radius:5px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--secondary),var(--correct));border-radius:5px;transition:width .3s ease}

.quiz-type-badge{font-size:.8rem;padding:6px 14px;border-radius:20px;background:var(--gradient);color:white;font-weight:600;align-self:flex-start}
.quiz-question{font-size:1.2rem;font-weight:700;line-height:1.6;text-align:center;padding:20px;background:var(--card);border-radius:18px;box-shadow:var(--shadow);width:100%;max-width:400px;min-height:100px;display:flex;align-items:center;justify-content:center}

.quiz-options{display:flex;flex-direction:column;gap:10px;width:100%;max-width:400px}
.option-btn{padding:16px 20px;border:2px solid #dfe6e9;border-radius:16px;background:var(--card);font-size:1.05rem;font-weight:600;cursor:pointer;transition:all .2s;text-align:left;font-family:inherit;display:flex;align-items:center;gap:12px;-webkit-tap-highlight-color:transparent;line-height:1.4}
.option-btn:hover{border-color:var(--primary);background:#fff5f5}
.option-btn:active{transform:scale(.97)}
.option-btn .option-label{min-width:32px;height:32px;border-radius:50%;background:#dfe6e9;display:flex;align-items:center;justify-content:center;font-size:.9rem;font-weight:700;flex-shrink:0}
.option-btn.selected{border-color:var(--primary);background:#fff5f5}
.option-btn.correct{border-color:var(--correct);background:#d4f5e9;animation:glow .8s ease-in-out}
.option-btn.correct .option-label{background:var(--correct);color:#fff}
.option-btn.wrong{border-color:var(--wrong);background:#ffe0d6;animation:wrongShake .6s}
.option-btn.wrong .option-label{background:var(--wrong);color:#fff}
.option-btn:disabled{cursor:default}

/* Enhanced Effects */
.effect-stars{position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:150}
.falling-star{position:absolute;font-size:2rem;animation:starFall 2s linear forwards;z-index:151}
.celebration-emoji{position:fixed;font-size:3rem;pointer-events:none;z-index:150;animation:bounce 1s ease-out}

/* OX Enhanced */
.ox-options{display:flex;gap:16px;width:100%;max-width:400px;justify-content:center}
.ox-btn{flex:1;max-width:180px;padding:32px;font-size:3rem;border:4px solid #dfe6e9;border-radius:24px;background:var(--card);cursor:pointer;transition:all .2s;font-family:inherit}
.ox-btn:hover{transform:scale(1.05)}
.ox-btn:active{transform:scale(.95)}
.ox-btn.correct{border-color:var(--correct);background:#d4f5e9;animation:glow .8s}
.ox-btn.wrong{border-color:var(--wrong);background:#ffe0d6;animation:wrongShake .6s}

/* Order Enhanced */
.order-area{width:100%;max-width:400px}
.order-hint{text-align:center;font-size:.9rem;color:#636e72;margin-bottom:12px;padding:8px;background:#f8f9fa;border-radius:8px}
.order-items{display:flex;flex-direction:column;gap:8px}
.order-item{padding:14px 18px;border:2px solid #dfe6e9;border-radius:14px;background:var(--card);font-size:1rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:12px;transition:all .2s;user-select:none;position:relative}
.order-item:hover{border-color:var(--primary)}
.order-item .order-num{min-width:30px;height:30px;border-radius:50%;background:#dfe6e9;display:flex;align-items:center;justify-content:center;font-size:.85rem;font-weight:700;transition:all .2s}
.order-item.selected-order{border-color:var(--primary);background:#fff5f5}
.order-item.selected-order .order-num{background:var(--primary);color:white}
.order-submit{margin-top:16px;width:100%}

/* Fill Enhanced */
.fill-area{width:100%;max-width:400px;display:flex;flex-direction:column;gap:12px;align-items:center}
.fill-input{width:100%;padding:16px 20px;border:3px solid #dfe6e9;border-radius:16px;font-size:1.2rem;font-weight:600;text-align:center;font-family:inherit;outline:none;transition:all .2s}
.fill-input:focus{border-color:var(--primary);box-shadow:0 0 0 4px rgba(255,107,107,0.1)}
.fill-hint{font-size:.9rem;color:#636e72;background:#f8f9fa;padding:8px 16px;border-radius:12px}

/* Mock Exam Mode */
.exam-mode{background:linear-gradient(135deg,#667eea,#764ba2);color:white}
.exam-timer{font-size:1.2rem;font-weight:bold;color:#FFD700;text-shadow:1px 1px 2px rgba(0,0,0,0.3)}
.exam-warning{animation:wrongShake .5s infinite;color:#FF4757!important}

/* Feedback Enhanced */
.feedback{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:200;animation:fadeIn .3s;padding:20px}
.feedback-bg{position:absolute;inset:0;background:rgba(0,0,0,.5)}
.feedback-card{position:relative;background:var(--card);border-radius:28px;padding:32px 28px;text-align:center;max-width:380px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.3);animation:slideUp .4s}
.feedback-emoji{font-size:4rem;margin-bottom:12px;animation:bounce .8s}
.feedback-title{font-size:1.4rem;font-weight:700;margin-bottom:8px}
.feedback-desc{font-size:1rem;color:#636e72;margin-bottom:8px;line-height:1.6}
.feedback-stars{font-size:2rem;margin:12px 0}
.feedback-stars span{display:inline-block;animation:starBurst .6s forwards;opacity:0}
.feedback-stars span:nth-child(2){animation-delay:.2s}
.feedback-stars span:nth-child(3){animation-delay:.4s}
.person-card-mini{margin:12px auto;padding:12px 18px;background:linear-gradient(135deg,var(--accent),#f9ca24);border-radius:16px;font-size:1rem;display:inline-flex;align-items:center;gap:10px;color:var(--text);font-weight:600}
.feedback-card .btn{margin-top:16px}

/* Result Enhanced */
#result-screen{justify-content:center;gap:20px;text-align:center}
.result-header{font-size:4rem;margin-bottom:8px;animation:bounce 1s}
.result-summary{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;width:100%;max-width:400px}
.result-stat{background:var(--card);border-radius:18px;padding:20px;box-shadow:var(--shadow);text-align:center;animation:pop .5s}
.result-stat .stat-value{font-size:2rem;font-weight:700;margin-bottom:4px}
.result-stat .stat-label{font-size:.85rem;color:#636e72}
.grade-prediction{background:linear-gradient(135deg,var(--accent),#f9ca24);padding:16px 24px;border-radius:20px;font-weight:700;font-size:1.1rem;margin:12px 0;animation:levelUp .8s}
.result-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;max-width:400px;margin:12px 0}
.result-person{background:var(--card);border-radius:16px;padding:12px;box-shadow:var(--shadow);text-align:center;font-size:.85rem;animation:pop .6s}
.result-person .rp-emoji{font-size:2rem;margin-bottom:4px}
.result-btns{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
.level-up-banner{background:linear-gradient(135deg,var(--accent),#f9ca24);padding:16px 28px;border-radius:20px;font-weight:700;font-size:1.2rem;animation:levelUp .8s;margin-bottom:12px}

/* Collection Enhanced */
#collection-screen{gap:16px;padding-bottom:40px}
.collection-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;width:100%;max-width:450px}
.person-card{background:var(--card);border-radius:20px;padding:16px 10px;box-shadow:var(--shadow);text-align:center;transition:all .2s;cursor:pointer}
.person-card:hover{transform:translateY(-3px)}
.person-card.locked{opacity:.4;filter:grayscale(1);cursor:default}
.person-card .pc-emoji{font-size:2.5rem;margin-bottom:6px}
.person-card .pc-name{font-size:.95rem;font-weight:700;margin-bottom:4px}
.person-card .pc-desc{font-size:.75rem;color:#636e72;line-height:1.3;margin-bottom:6px}
.person-card .pc-era{font-size:.7rem;padding:3px 10px;background:var(--gradient);color:white;border-radius:10px;display:inline-block}

/* Rankings */
#ranking-screen{gap:16px;padding-bottom:40px}
.ranking-tabs{display:flex;gap:6px;margin-bottom:16px;background:#f1f2f6;border-radius:12px;padding:4px;width:100%;max-width:400px}
.ranking-tab{flex:1;padding:8px 12px;border:none;border-radius:8px;background:transparent;font-size:.9rem;font-weight:600;cursor:pointer;transition:all .2s;color:#636e72}
.ranking-tab.active{background:white;color:var(--primary);box-shadow:0 2px 4px rgba(0,0,0,0.1)}
.ranking-list{display:flex;flex-direction:column;gap:8px;width:100%;max-width:400px}
.ranking-item{display:flex;align-items:center;gap:12px;padding:14px 18px;background:var(--card);border-radius:16px;box-shadow:var(--shadow)}
.ranking-rank{min-width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:.9rem}
.ranking-rank.gold{background:linear-gradient(135deg,#FFD700,#FFA500);color:white}
.ranking-rank.silver{background:linear-gradient(135deg,#C0C0C0,#808080);color:white}
.ranking-rank.bronze{background:linear-gradient(135deg,#CD7F32,#8B4513);color:white}
.ranking-rank.normal{background:#dfe6e9;color:#636e72}
.ranking-info{flex:1}
.ranking-name{font-weight:600;margin-bottom:2px}
.ranking-score{font-size:.85rem;color:#636e72}
.nickname-input{width:100%;padding:12px 16px;border:2px solid #dfe6e9;border-radius:12px;font-size:1rem;margin-bottom:12px;text-align:center}

/* Back button and navigation */
.back-btn{position:absolute;top:16px;left:16px;z-index:10}
.top-bar{width:100%;display:flex;align-items:center;justify-content:space-between;max-width:450px}
.top-bar h2{margin:0;flex:1;text-align:center}

/* Bottom navigation for main features */
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:white;border-top:1px solid #dfe6e9;display:none;align-items:center;justify-content:space-around;padding:8px 0;z-index:100}
.nav-item{display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px 12px;cursor:pointer;transition:all .2s;font-size:.75rem;color:#636e72;min-width:80px}
.nav-item:hover{color:var(--primary)}
.nav-item.active{color:var(--primary)}
.nav-icon{font-size:1.5rem}

.empty-state{text-align:center;padding:40px 20px;color:#b2bec3;font-size:1rem}
.empty-state .empty-emoji{font-size:3.5rem;margin-bottom:12px;display:block}

.reset-btn{position:fixed;bottom:12px;right:12px;font-size:.7rem;padding:6px 12px;border-radius:8px;background:#dfe6e9;border:none;color:#636e72;cursor:pointer;z-index:50;transition:all .2s}
.reset-btn:hover{background:#636e72;color:white}

/* Mobile responsive enhancements */
@media(min-width:500px){
  .screen{padding:32px}
  h1{font-size:2.4rem}
  .quiz-question{font-size:1.3rem}
  .stage-map{max-width:500px}
  .collection-grid{grid-template-columns:repeat(4,1fr);max-width:500px}
  .result-summary{grid-template-columns:repeat(4,1fr)}
}
</style>
</head>
<body>

<!-- MAIN SCREEN -->
<div id="main-screen" class="screen active">
  <div class="main-character">ğŸ§™â€â™‚ï¸</div>
  <div class="title-area">
    <span class="title-emoji">ğŸ¯</span>
    <h1>í•œêµ­ì‚¬ íƒ€ì„ì–´ë“œë²¤ì²˜ 2.0</h1>
    <p class="title-sub">ì‹œê°„ì—¬í–‰í•˜ë©° ì—­ì‚¬ë¥¼ ë§ˆìŠ¤í„°í•˜ì! âœ¨</p>
  </div>
  <div id="main-player-info" class="player-info" style="display:none">
    <span class="level-badge" id="main-level">Lv.1</span>
    <span id="main-title">ì—­ì‚¬ ì´ˆë³´</span>
    <span style="margin-left:auto">â­ <span id="main-stars">0</span></span>
  </div>
  <div class="progress-stats" id="progress-stats" style="display:none">
    <span>ğŸ¯ ì „ì²´ ì§„í–‰ë¥ : <span id="total-progress">0%</span></span>
    <span>ğŸ† ì´ ë³„: <span id="total-stars-count">0</span></span>
  </div>
  <div class="main-btns">
    <button class="btn btn-primary" onclick="showScreen('stage-screen')">ğŸš€ ëª¨í—˜ ì‹œì‘!</button>
    <button class="btn btn-secondary" onclick="showScreen('exam-screen')">ğŸ“ ëª¨ì˜ì‹œí—˜</button>
    <button class="btn btn-accent" onclick="showScreen('collection-screen')">ğŸ“š ì¸ë¬¼ ë„ê°</button>
    <button class="btn btn-outline" onclick="showScreen('ranking-screen')">ğŸ† ë­í‚¹</button>
    <button class="btn btn-outline" onclick="showScreen('wrong-screen')">ğŸ“„ ì˜¤ë‹µë…¸íŠ¸</button>
  </div>
</div>

<!-- STAGE SELECT -->
<div id="stage-screen" class="screen">
  <div class="top-bar">
    <button class="btn btn-sm btn-outline" onclick="showScreen('main-screen')">â† ë’¤ë¡œ</button>
    <h2>ğŸ—ºï¸ ì‹œëŒ€ë³„ ëª¨í—˜</h2>
    <div style="width:60px"></div>
  </div>
  <div class="stage-map" id="stage-map"></div>
</div>

<!-- MOCK EXAM SETUP -->
<div id="exam-screen" class="screen">
  <div class="top-bar">
    <button class="btn btn-sm btn-outline" onclick="showScreen('main-screen')">â† ë’¤ë¡œ</button>
    <h2>ğŸ“ ëª¨ì˜ì‹œí—˜</h2>
    <div style="width:60px"></div>
  </div>
  <div class="card" style="text-align:center">
    <h3 style="margin-bottom:16px">ğŸ¯ ì‹¤ì „ ëª¨ì˜ì‹œí—˜</h3>
    <p style="color:#636e72;margin-bottom:20px">ì „ ì‹œëŒ€ ë¬¸ì œ 20ê°œ â€¢ 20ë¶„ ì‹œê°„ì œí•œ<br>í•œêµ­ì‚¬ëŠ¥ë ¥ê²€ì •ì‹œí—˜ 6ê¸‰ ìˆ˜ì¤€</p>
    <div style="background:#f8f9fa;padding:16px;border-radius:12px;margin-bottom:20px">
      <div style="font-size:.9rem;color:#636e72;margin-bottom:8px">ì˜ˆìƒ ê²°ê³¼</div>
      <div style="font-size:.8rem;line-height:1.4">
        18-20ì : 6ê¸‰ í•©ê²© ì˜ˆìƒ! ğŸ†<br>
        15-17ì : 7ê¸‰ ìˆ˜ì¤€ ğŸ’ª<br>
        12-14ì : 8ê¸‰ ìˆ˜ì¤€ ğŸ“š<br>
        0-11ì : ë” ê³µë¶€ê°€ í•„ìš”í•´ìš” âœŠ
      </div>
    </div>
    <button class="btn btn-primary" onclick="startExam()">ğŸš€ ì‹œí—˜ ì‹œì‘!</button>
  </div>
</div>

<!-- QUIZ SCREEN -->
<div id="quiz-screen" class="screen">
  <div class="quiz-header">
    <span class="quiz-progress" id="quiz-progress">1 / 12</span>
    <span class="quiz-timer" id="quiz-timer">â± 15</span>
  </div>
  <div class="combo-counter" id="combo-counter">ğŸ”¥ ì½¤ë³´ x3</div>
  <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
  <span class="quiz-type-badge" id="quiz-type-badge">4ì§€ì„ ë‹¤</span>
  <div class="quiz-question" id="quiz-question"></div>
  <div id="quiz-options-area"></div>
</div>

<!-- RESULT SCREEN -->
<div id="result-screen" class="screen">
  <div class="result-header" id="result-header">ğŸ‰</div>
  <h1 id="result-title">ì‹œëŒ€ í´ë¦¬ì–´!</h1>
  <div id="level-up-area"></div>
  <div id="grade-area"></div>
  <div class="result-summary" id="result-summary"></div>
  <div id="result-cards-area"></div>
  <div class="result-btns" id="result-btns">
    <button class="btn btn-primary" onclick="retryCurrentStage()">ğŸ”„ ë‹¤ì‹œ ë„ì „</button>
    <button class="btn btn-secondary" onclick="showScreen('main-screen')">ğŸ  ë©”ì¸ìœ¼ë¡œ</button>
  </div>
</div>

<!-- COLLECTION SCREEN -->
<div id="collection-screen" class="screen">
  <div class="top-bar">
    <button class="btn btn-sm btn-outline" onclick="showScreen('main-screen')">â† ë’¤ë¡œ</button>
    <h2>ğŸ“š ì¸ë¬¼ ë„ê°</h2>
    <div style="width:60px"></div>
  </div>
  <p style="font-size:.9rem;color:#636e72;text-align:center" id="collection-count">0 / 32 ìˆ˜ì§‘</p>
  <div class="collection-grid" id="collection-grid"></div>
</div>

<!-- RANKING SCREEN -->
<div id="ranking-screen" class="screen">
  <div class="top-bar">
    <button class="btn btn-sm btn-outline" onclick="showScreen('main-screen')">â† ë’¤ë¡œ</button>
    <h2>ğŸ† ë­í‚¹</h2>
    <div style="width:60px"></div>
  </div>
  <div class="card" style="margin-bottom:16px">
    <input type="text" class="nickname-input" id="nickname-input" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="10">
    <button class="btn btn-primary btn-sm" onclick="saveNickname()">ë‹‰ë„¤ì„ ì €ì¥</button>
  </div>
  <div class="ranking-tabs">
    <button class="ranking-tab active" onclick="showRanking('total')">ì „ì²´</button>
    <button class="ranking-tab" onclick="showRanking('exam')">ëª¨ì˜ì‹œí—˜</button>
    <button class="ranking-tab" onclick="showRanking('stage')">ì‹œëŒ€ë³„</button>
  </div>
  <div class="ranking-list" id="ranking-list"></div>
</div>

<!-- WRONG NOTES SCREEN -->
<div id="wrong-screen" class="screen">
  <div class="top-bar">
    <button class="btn btn-sm btn-outline" onclick="showScreen('main-screen')">â† ë’¤ë¡œ</button>
    <h2>ğŸ“„ ì˜¤ë‹µë…¸íŠ¸</h2>
    <div style="width:60px"></div>
  </div>
  <div style="display:flex;gap:8px;margin-bottom:12px">
    <button class="btn btn-sm btn-outline" id="retry-wrong-btn" onclick="retryWrongQuestions()" style="display:none">ğŸ”„ í‹€ë¦°ë¬¸ì œ ì¬ë„ì „</button>
    <button class="btn btn-sm btn-outline" id="clear-wrong-btn" onclick="clearWrongNotes()" style="display:none">ğŸ—‘ï¸ ë¹„ìš°ê¸°</button>
  </div>
  <div id="wrong-list" class="wrong-list"></div>
</div>

<!-- EFFECTS -->
<div class="effect-stars" id="effect-stars"></div>

<!-- FEEDBACK OVERLAY -->
<div id="feedback-overlay" class="feedback" style="display:none">
  <div class="feedback-bg" onclick="closeFeedbackAndNext()"></div>
  <div class="feedback-card" id="feedback-card"></div>
</div>

<!-- Person Detail Overlay -->
<div id="person-detail-overlay" class="person-detail-overlay" style="display:none" onclick="hidePersonDetail()">
  <div class="person-detail" id="person-detail-content" onclick="event.stopPropagation()">
    <button class="btn btn-sm btn-outline" onclick="hidePersonDetail()" style="position:absolute;top:12px;right:12px;padding:6px 10px">âœ•</button>
  </div>
</div>

<button class="reset-btn" onclick="resetGame()">ì´ˆê¸°í™”</button>

<script>
// ==================== ENHANCED DATA ====================
const PERSONS = {
  // ì„ ì‚¬ì‹œëŒ€ & ê³ ì¡°ì„ 
  gojoseon_king: {emoji:'ğŸ‘‘',name:'ë‹¨êµ°ì™•ê²€',desc:'ê³ ì¡°ì„ ì„ ê±´êµ­í•œ ì „ì„¤ì˜ ì™•',detail:'ë‹¨êµ°ì™•ê²€ì€ ìš°ë¦¬ë‚˜ë¼ ìµœì´ˆì˜ êµ­ê°€ì¸ ê³ ì¡°ì„ ì„ ì„¸ìš´ ì „ì„¤ ì† ì¸ë¬¼ì´ì—ìš”. í•˜ëŠ˜ì—ì„œ ë‚´ë ¤ì˜¨ í™˜ì›…ê³¼ ì›…ë…€ ì‚¬ì´ì—ì„œ íƒœì–´ë‚¬ë‹¤ê³  ì „í•´ì ¸ìš”. ê°œì²œì ˆì˜ ì£¼ì¸ê³µì´ëë‹ˆë‹¤!',era:'ê³ ì¡°ì„ '},
  dolmen_builder: {emoji:'ğŸ—¿',name:'ê±°ì„ë¬¸í™”ì¸',desc:'ê³ ì¸ëŒì„ ë§Œë“  ì²­ë™ê¸°ì¸',detail:'ì²­ë™ê¸°ì‹œëŒ€ ì‚¬ëŒë“¤ì´ ë§Œë“  ê±°ëŒ€í•œ ëŒë¬´ë¤ì´ ê³ ì¸ëŒì´ì—ìš”. ê°•í™”ë„, ì „ë‚¨ ê³ ì°½ ë“±ì— ë§ì´ ë‚¨ì•„ìˆì–´ì„œ ì„¸ê³„ë¬¸í™”ìœ ì‚°ìœ¼ë¡œ ì§€ì •ë˜ê¸°ë„ í–ˆë‹µë‹ˆë‹¤!',era:'ì„ ì‚¬ì‹œëŒ€'},
  iron_master: {emoji:'âš’ï¸',name:'ì² ê¸°ì¥ì¸',desc:'ì² ê¸° ì œì‘ ê¸°ìˆ ì„ ë°œì „ì‹œí‚¨ ì¥ì¸',detail:'ì² ê¸°ì‹œëŒ€ê°€ ë˜ë©´ì„œ ë†ê¸°êµ¬ì™€ ë¬´ê¸°ê°€ ë°œë‹¬í–ˆì–´ìš”. ì² ë¡œ ë§Œë“  ë„êµ¬ëŠ” ì²­ë™ê¸°ë³´ë‹¤ í›¨ì”¬ ë‹¨ë‹¨í•˜ê³  ìœ ìš©í–ˆë‹µë‹ˆë‹¤!',era:'ì² ê¸°ì‹œëŒ€'},
  wiman: {emoji:'ğŸ°',name:'ìœ„ë§Œ',desc:'ê³ ì¡°ì„  ë§ˆì§€ë§‰ ì™•ì¡°ë¥¼ ì„¸ìš´ ì¸ë¬¼',detail:'ì¤‘êµ­ì—ì„œ ì˜¨ ìœ„ë§Œì´ ê³ ì¡°ì„ ì˜ ì¤€ì™•ì„ ëª°ì•„ë‚´ê³  ìœ„ë§Œì¡°ì„ ì„ ì„¸ì› ì–´ìš”. í•œë‚˜ë¼ì™€ ë§ì„œ ì‹¸ì› ì§€ë§Œ ê²°êµ­ ë©¸ë§í–ˆë‹µë‹ˆë‹¤.',era:'ìœ„ë§Œì¡°ì„ '},
  
  // ì‚¼êµ­ì‹œëŒ€
  jumong: {emoji:'ğŸ¹',name:'ì£¼ëª½',desc:'ê³ êµ¬ë ¤ë¥¼ ì„¸ìš´ ì™•',detail:'ì£¼ëª½ì€ ë¶€ì—¬ì—ì„œ ë‚´ë ¤ì™€ ê³ êµ¬ë ¤ë¥¼ ì„¸ì› ì–´ìš”. í™œì„ ì•„ì£¼ ì˜ ì˜ì•„ì„œ "ì£¼ëª½"ì´ë¼ëŠ” ì´ë¦„ì´ ë¶™ì—ˆë‹µë‹ˆë‹¤! ê³ êµ¬ë ¤ì˜ ì²« ë²ˆì§¸ ì™•ì´ì—ìš”.',era:'ê³ êµ¬ë ¤'},
  gwanggaeto:{emoji:'âš”ï¸',name:'ê´‘ê°œí† ëŒ€ì™•',desc:'ê³ êµ¬ë ¤ ì˜í† ë¥¼ ë„“íŒ ìœ„ëŒ€í•œ ì™•',detail:'ê´‘ê°œí† ëŒ€ì™•ì€ ê³ êµ¬ë ¤ì˜ ì˜í† ë¥¼ í¬ê²Œ ë„“íŒ ì™•ì´ì—ìš”. ë§Œì£¼ì™€ í•œë°˜ë„ ë¶ë¶€ë¥¼ ì°¨ì§€í–ˆê³ , ê´‘ê°œí† ëŒ€ì™•ë¦‰ë¹„ì— ê·¸ ì—…ì ì´ ê¸°ë¡ë˜ì–´ ìˆì–´ìš”.',era:'ê³ êµ¬ë ¤'},
  jangsu:{emoji:'ğŸ‘‘',name:'ì¥ìˆ˜ì™•',desc:'í‰ì–‘ìœ¼ë¡œ ìˆ˜ë„ë¥¼ ì˜®ê¸´ ì™•',detail:'ì¥ìˆ˜ì™•ì€ ê´‘ê°œí† ëŒ€ì™•ì˜ ì•„ë“¤ë¡œ, ìˆ˜ë„ë¥¼ êµ­ë‚´ì„±ì—ì„œ í‰ì–‘ìœ¼ë¡œ ì˜®ê²¼ì–´ìš”. ì´ë¦„ì²˜ëŸ¼ ì˜¤ë˜ ì‚´ì•˜ê³ (98ì„¸!), ê³ êµ¬ë ¤ì˜ ì „ì„±ê¸°ë¥¼ ì´ëŒì—ˆë‹µë‹ˆë‹¤.',era:'ê³ êµ¬ë ¤'},
  onjo:{emoji:'ğŸ›ï¸',name:'ì˜¨ì¡°',desc:'ë°±ì œë¥¼ ì„¸ìš´ ì™•',detail:'ì˜¨ì¡°ëŠ” ì£¼ëª½ì˜ ì•„ë“¤ë¡œ, ë‚¨ìª½ìœ¼ë¡œ ë‚´ë ¤ì™€ ìœ„ë¡€ì„±ì— ë°±ì œë¥¼ ì„¸ì› ì–´ìš”. í•œê°• ìœ ì—­ì„ ì¤‘ì‹¬ìœ¼ë¡œ ê°•ë ¥í•œ ë‚˜ë¼ë¥¼ ë§Œë“¤ì—ˆë‹µë‹ˆë‹¤.',era:'ë°±ì œ'},
  geunchogo:{emoji:'ğŸ›¡ï¸',name:'ê·¼ì´ˆê³ ì™•',desc:'ë°±ì œì˜ ì „ì„±ê¸°ë¥¼ ì´ëˆ ì™•',detail:'ê·¼ì´ˆê³ ì™•ì€ ë°±ì œì˜ ì „ì„±ê¸°ë¥¼ ì´ëˆ ì™•ì´ì—ìš”. ë§ˆí•œì„ ëª¨ë‘ í†µí•©í•˜ê³ , ì¼ë³¸ê³¼ ì¤‘êµ­ì—ë„ êµë¥˜í–ˆë‹µë‹ˆë‹¤. ê³ êµ¬ë ¤ ê³ êµ­ì›ì™•ì„ ì „ì‚¬ì‹œí‚¤ê¸°ë„ í–ˆì–´ìš”.',era:'ë°±ì œ'},
  
  // ë‚¨ë¶êµ­ì‹œëŒ€ - í†µì¼ì‹ ë¼ & ë°œí•´
  munmu:{emoji:'ğŸŒŠ',name:'ë¬¸ë¬´ì™•',desc:'ì‚¼êµ­í†µì¼ì„ ì™„ì„±í•œ ì‹ ë¼ì™•',detail:'ë¬¸ë¬´ì™•ì€ ë°±ì œì™€ ê³ êµ¬ë ¤ë¥¼ ì°¨ë¡€ë¡œ ë©¸ë§ì‹œí‚¤ê³  ë‹¹ë‚˜ë¼ ì„¸ë ¥ê¹Œì§€ ì¶•ì¶œí•˜ì—¬ ìµœì´ˆë¡œ í•œë°˜ë„ë¥¼ í†µì¼í–ˆì–´ìš”. ë°”ë‹¤ì˜ ìš©ì´ ë˜ì–´ ë‚˜ë¼ë¥¼ ì§€í‚¤ê² ë‹¤ë©° ë™í•´ì— ë¬»í˜”ë‹µë‹ˆë‹¤.',era:'í†µì¼ì‹ ë¼'},
  wonhyo:{emoji:'ğŸ“¿',name:'ì›íš¨ëŒ€ì‚¬',desc:'ë¶ˆêµë¥¼ ëŒ€ì¤‘í™”í•œ ê³ ìŠ¹',detail:'ì›íš¨ëŒ€ì‚¬ëŠ” ì–´ë ¤ìš´ ë¶ˆêµë¥¼ ì¼ë°˜ ë°±ì„±ë“¤ë„ ì´í•´í•˜ê¸° ì‰½ê²Œ ì „íŒŒí•œ ê³ ìŠ¹ì´ì—ìš”. "ë‚˜ë¬´ì•„ë¯¸íƒ€ë¶ˆ"ì„ ì™¸ì¹˜ë©° ì¶¤ì¶”ê³  ë…¸ë˜í–ˆë˜ íŒŒê²©ì ì¸ ìŠ¤ë‹˜ì´ì—ˆë‹µë‹ˆë‹¤!',era:'í†µì¼ì‹ ë¼'},
  uisang:{emoji:'ğŸ¯',name:'ì˜ìƒëŒ€ì‚¬',desc:'í™”ì—„ì‚¬ìƒì„ ì „íŒŒí•œ ê³ ìŠ¹',detail:'ì˜ìƒëŒ€ì‚¬ëŠ” ë‹¹ë‚˜ë¼ì—ì„œ í™”ì—„ì‚¬ìƒì„ ë°°ì›Œì™€ í•œêµ­ ë¶ˆêµë°œì „ì— í¬ê²Œ ê¸°ì—¬í–ˆì–´ìš”. ë¶€ì„ì‚¬ë¥¼ ì°½ê±´í•˜ê³  ë§ì€ ì œìë¥¼ ê¸¸ëŸ¬ëƒˆë‹µë‹ˆë‹¤.',era:'í†µì¼ì‹ ë¼'},
  dae_joyeong:{emoji:'ğŸ‘‘',name:'ëŒ€ì¡°ì˜',desc:'ë°œí•´ë¥¼ ê±´êµ­í•œ ì™•',detail:'ê³ êµ¬ë ¤ê°€ ë©¸ë§í•œ í›„ ëŒ€ì¡°ì˜ì´ ê³ êµ¬ë ¤ ìœ ë¯¼ê³¼ ë§ê°ˆì¡±ì„ ì´ëŒê³  ë°œí•´ë¥¼ ì„¸ì› ì–´ìš”. "í•´ë™ì„±êµ­"ì´ë¼ ë¶ˆë¦´ ì •ë„ë¡œ ê°•ì„±í–ˆë˜ ë‚˜ë¼ì˜ ì²« ì„ê¸ˆì´ì—ìš”!',era:'ë°œí•´'},
  jang_bogo:{emoji:'â›µ',name:'ì¥ë³´ê³ ',desc:'í•´ìƒì™•ì´ë¼ ë¶ˆë¦° ì‹ ë¼ ìƒì¸',detail:'ì¥ë³´ê³ ëŠ” ì²­í•´ì§„ì„ ì„¤ì¹˜í•˜ê³  ë™ì•„ì‹œì•„ í•´ìƒë¬´ì—­ì„ ì¥ì•…í•œ ì‹ ë¼ì˜ í•´ìƒì™•ì´ì—ìš”. ë‹¹ë‚˜ë¼, ì¼ë³¸ê³¼ì˜ ë¬´ì—­ì„ í†µí•´ ì—„ì²­ë‚œ ë¶€ë¥¼ ì¶•ì í–ˆë‹µë‹ˆë‹¤!',era:'í†µì¼ì‹ ë¼'},
  
  // ê³ ë ¤
  wang_geon:{emoji:'ğŸ°',name:'ì™•ê±´',desc:'ê³ ë ¤ë¥¼ ê±´êµ­í•œ íƒœì¡°',detail:'ì™•ê±´ì€ í›„ì‚¼êµ­ì„ í†µì¼í•˜ê³  ê³ ë ¤ë¥¼ ì„¸ì› ì–´ìš”. ê°œì„±ì— ë„ìì„ ì •í•˜ê³  "ë¯¼ë³¸ì •ì¹˜"ë¥¼ ê°•ì¡°í–ˆìœ¼ë©°, í›ˆìš”ì‹­ì¡°ë¥¼ ë‚¨ê²¨ í›„ì†ë“¤ì—ê²Œ ì •ì¹˜ì˜ ì›ì¹™ì„ ì œì‹œí–ˆë‹µë‹ˆë‹¤.',era:'ê³ ë ¤'},
  sejong_goryeo:{emoji:'ğŸ“š',name:'ê´‘ì¢…',desc:'ë…¸ì˜ˆì•ˆê²€ë²•ì„ ì‹¤ì‹œí•œ ê³ ë ¤ì™•',detail:'ê³ ë ¤ ê´‘ì¢…ì€ ë…¸ì˜ˆì•ˆê²€ë²•ìœ¼ë¡œ í˜¸ì¡±ë“¤ì˜ í˜ì„ ì•½í™”ì‹œí‚¤ê³  ê³¼ê±°ì œë¥¼ ë„ì…í•´ ì‹ ì§„ì‚¬ëŒ€ë¶€ë¥¼ ë“±ìš©í–ˆì–´ìš”. ì™•ê¶Œê°•í™”ì— í° ì—­í• ì„ í–ˆë‹µë‹ˆë‹¤.',era:'ê³ ë ¤'},
  seo_hui:{emoji:'ğŸ­',name:'ì„œí¬',desc:'ê±°ë€ì˜ ì¹¨ì…ì„ ë§ë¡œ ë§‰ì€ ì™¸êµê´€',detail:'ì„œí¬ëŠ” ê±°ë€ì˜ 1ì°¨ ì¹¨ì… ë•Œ ì†Œì†ë…•ê³¼ ë‹´íŒì„ ë²Œì—¬ ì „ìŸ ì—†ì´ ê°•ë™ 6ì£¼ë¥¼ ì–»ì–´ë‚¸ ë›°ì–´ë‚œ ì™¸êµê´€ì´ì—ìš”. "ë§ í•œ ë§ˆë””ë¡œ ì„± ì²œ ê°œë¥¼ ì–»ì—ˆë‹¤"ëŠ” ë§ì´ ìˆë‹µë‹ˆë‹¤!',era:'ê³ ë ¤'},
  gang_gam_chan:{emoji:'ğŸ¹',name:'ê°•ê°ì°¬',desc:'ê·€ì£¼ëŒ€ì²©ì˜ ì˜ì›…',detail:'ê°•ê°ì°¬ì€ ê±°ë€ì˜ 3ì°¨ ì¹¨ì… ë•Œ ê·€ì£¼ì—ì„œ ê±°ë€êµ° ëŒ€ë¶€ë¶„ì„ ë¬¼ë¦¬ì¹œ ëª…ì¥ì´ì—ìš”. ë¬¼ì„ ë§‰ì•„ë‘ì—ˆë‹¤ê°€ í•œë²ˆì— í„°ëœ¨ë ¤ ì ì„ ë¬¼ë¦¬ì¹˜ëŠ” ì§€ëµì„ ì‚¬ìš©í–ˆë‹µë‹ˆë‹¤!',era:'ê³ ë ¤'},
  choi_chung_heon:{emoji:'âš”ï¸',name:'ìµœì¶©í—Œ',desc:'ë¬´ì‹ ì •ê¶Œì„ ì„¸ìš´ ë¬´ì‹ ',detail:'ìµœì¶©í—Œì€ ë¬´ì‹ ì •ë³€ ì´í›„ ì‹¤ê¶Œì„ ì¡ê³  ë¬´ì‹ ì •ê¶Œì„ í™•ë¦½í–ˆì–´ìš”. ì™•ì„ í—ˆìˆ˜ì•„ë¹„ë¡œ ë§Œë“¤ê³  ìì‹ ì´ ì‹¤ì§ˆì ìœ¼ë¡œ ë‚˜ë¼ë¥¼ ë‹¤ìŠ¤ë¦° ì¸ë¬¼ì´ëë‹ˆë‹¤.',era:'ê³ ë ¤'},
  
  // ì¡°ì„  ì „ê¸°
  yi_seong_gye:{emoji:'ğŸ¹',name:'ì´ì„±ê³„',desc:'ì¡°ì„ ì„ ê±´êµ­í•œ íƒœì¡°',detail:'ì´ì„±ê³„ëŠ” ìœ„í™”ë„ íšŒêµ°ìœ¼ë¡œ ê³ ë ¤ë¥¼ ë¬´ë„ˆëœ¨ë¦¬ê³  ì¡°ì„ ì„ ì„¸ì› ì–´ìš”. "ì¡°ì„ "ì´ë¼ëŠ” êµ­í˜¸ë¥¼ ì •í•˜ê³  í•œì–‘ìœ¼ë¡œ ìˆ˜ë„ë¥¼ ì˜®ê²¨ 500ë…„ ì™•ì¡°ì˜ ê¸°í‹€ì„ ë§ˆë ¨í–ˆë‹µë‹ˆë‹¤.',era:'ì¡°ì„ '},
  sejong:{emoji:'ğŸ“–',name:'ì„¸ì¢…ëŒ€ì™•',desc:'í•œê¸€ì„ ì°½ì œí•œ ì„±êµ°',detail:'ì„¸ì¢…ëŒ€ì™•ì€ ë°±ì„±ë“¤ì´ ì‰½ê²Œ ë°°ìš¸ ìˆ˜ ìˆëŠ” í›ˆë¯¼ì •ìŒ(í•œê¸€)ì„ ë§Œë“  ìœ„ëŒ€í•œ ì™•ì´ì—ìš”. ê³¼í•™ê¸°ìˆ  ë°œë‹¬ì—ë„ í˜ì¨ ì¸¡ìš°ê¸°, í•´ì‹œê³„ ë“±ì„ ë°œëª…í–ˆë‹µë‹ˆë‹¤!',era:'ì¡°ì„ '},
  jang_yeong_sil:{emoji:'âš™ï¸',name:'ì¥ì˜ì‹¤',desc:'ì¡°ì„  ìµœê³ ì˜ ê³¼í•™ê¸°ìˆ ì',detail:'ì¥ì˜ì‹¤ì€ ë…¸ì˜ˆ ì¶œì‹ ì´ì§€ë§Œ ë›°ì–´ë‚œ ì¬ëŠ¥ìœ¼ë¡œ ì„¸ì¢…ì˜ ì´ì• ë¥¼ ë°›ì€ ê³¼í•™ìì˜ˆìš”. ë¬¼ì‹œê³„, í•´ì‹œê³„, ì¸¡ìš°ê¸° ë“± ë§ì€ ê³¼í•™ ê¸°êµ¬ë¥¼ ë§Œë“¤ì—ˆë‹µë‹ˆë‹¤!',era:'ì¡°ì„ '},
  yi_hwang:{emoji:'ğŸ“',name:'ì´í™©(í‡´ê³„)',desc:'ì„±ë¦¬í•™ì„ ì§‘ëŒ€ì„±í•œ í•™ì',detail:'í‡´ê³„ ì´í™©ì€ ì¡°ì„  ì„±ë¦¬í•™ì˜ ëŒ€ê°€ë¡œ "ë™ë°©ì˜ ì£¼ì"ë¼ ë¶ˆë ¸ì–´ìš”. ë„ì‚°ì„œì›ì„ ì„¸ì›Œ í›„ì§„ ì–‘ì„±ì— í˜ì¼ê³ , ì¸ê°„ì˜ ë§ˆìŒì— ëŒ€í•´ ê¹Šì´ ì—°êµ¬í–ˆë‹µë‹ˆë‹¤.',era:'ì¡°ì„ '},
  yi_i:{emoji:'ğŸ‹',name:'ì´ì´(ìœ¨ê³¡)',desc:'ì‹¤ìš©ì  ê°œí˜ì„ ì¶”êµ¬í•œ í•™ì',detail:'ìœ¨ê³¡ ì´ì´ëŠ” í˜„ì‹¤ì ì¸ ê°œí˜ ì •ì±…ì„ ì œì‹œí•œ ì¡°ì„ ì˜ ëŒ€í•™ìì˜ˆìš”. "ì‹­ë§Œì–‘ë³‘ì„¤"ë¡œ êµ­ë°©ë ¥ ê°•í™”ë¥¼ ì£¼ì¥í–ˆê³ , ë§ì€ êµìœ¡ê¸°ê´€ì„ ì„¸ì› ë‹µë‹ˆë‹¤.',era:'ì¡°ì„ '},
  
  // ì¡°ì„  í›„ê¸° & ê°œí™”ê¸°  
  sejong_late:{emoji:'ğŸ“š',name:'ì •ì¡°',desc:'ë¬¸ì˜ˆë¶€í¥ì„ ì´ëˆ ì¡°ì„  í›„ê¸° ì™•',detail:'ì •ì¡°ëŠ” ê·œì¥ê°ì„ ì„¤ì¹˜í•˜ê³  ìˆ˜ì› í™”ì„±ì„ ì¶•ì¡°í•œ ë¬¸í™”êµ°ì£¼ì˜ˆìš”. í•™ë¬¸ì„ ì¥ë ¤í•˜ê³  ì‹¤í•™ì„ í›„ì›í•˜ì—¬ ì¡°ì„  í›„ê¸° ë¬¸ì˜ˆë¶€í¥ì„ ì´ëŒì—ˆë‹µë‹ˆë‹¤!',era:'ì¡°ì„  í›„ê¸°'},
  park_ji_won:{emoji:'âœï¸',name:'ë°•ì§€ì›',desc:'ì—´í•˜ì¼ê¸°ë¥¼ ì“´ ì‹¤í•™ì',detail:'ì—°ì•” ë°•ì§€ì›ì€ ì‹¤í•™ìë¡œ "ì—´í•˜ì¼ê¸°"ë¥¼ ì¼ì–´ìš”. ì¤‘êµ­ ë¬¸ë¬¼ì„ ì§ì ‘ ë³´ê³  ì¡°ì„ ì˜ ë°œì „ ë°©í–¥ì„ ì œì‹œí–ˆìœ¼ë©°, "í—ˆìƒì „" ë“±ì˜ í•œë¬¸ì†Œì„¤ë„ ì¼ë‹µë‹ˆë‹¤.',era:'ì‹¤í•™'},
  hong_dae_yong:{emoji:'ğŸŒ',name:'í™ëŒ€ìš©',desc:'ì§€êµ¬ê°€ ë‘¥ê¸€ë‹¤ê³  ì£¼ì¥í•œ ì‹¤í•™ì',detail:'ë‹´í—Œ í™ëŒ€ìš©ì€ ì§€êµ¬ê°€ ë‘¥ê¸€ê³  ìì „í•œë‹¤ëŠ” ì§€ì „ì„¤ì„ ì£¼ì¥í•œ ê³¼í•™ìì˜ˆìš”. "ì˜ì‚°ë¬¸ë‹µ"ì„ ì¨ì„œ ì¡°ì„ ì˜ ì‚¬ëŒ€ì£¼ì˜ë¥¼ ë¹„íŒí–ˆë‹µë‹ˆë‹¤.',era:'ì‹¤í•™'},
  jeong_yag_yong:{emoji:'ğŸ—ï¸',name:'ì •ì•½ìš©',desc:'ëª©ë¯¼ì‹¬ì„œë¥¼ ì“´ ì‹¤í•™ì˜ ì§‘ëŒ€ì„±ì',detail:'ë‹¤ì‚° ì •ì•½ìš©ì€ ì‹¤í•™ì„ ì§‘ëŒ€ì„±í•œ í•™ìë¡œ "ëª©ë¯¼ì‹¬ì„œ", "ê²½ì„¸ìœ í‘œ" ë“±ì„ ì¼ì–´ìš”. ìˆ˜ì› í™”ì„± ì„¤ê³„ì—ë„ ì°¸ì—¬í–ˆê³  ê±°ì¤‘ê¸°ë¥¼ ë°œëª…í–ˆë‹µë‹ˆë‹¤!',era:'ì‹¤í•™'},
  heungseon:{emoji:'ğŸ‘‘',name:'í¥ì„ ëŒ€ì›êµ°',desc:'ì‡„êµ­ì •ì±…ì„ í¼ì¹œ ì¡°ì„  í›„ê¸° ê¶Œë ¥ì',detail:'í¥ì„ ëŒ€ì›êµ°ì€ ê³ ì¢…ì˜ ì•„ë²„ì§€ë¡œ ì„­ì •ì„ í–ˆì–´ìš”. ê²½ë³µê¶ì„ ì¬ê±´í•˜ê³  ì„œì›ì„ ì² íí–ˆì§€ë§Œ, ì‡„êµ­ì •ì±…ìœ¼ë¡œ ê°œí™”ë¥¼ ëŠ¦ì¶° ë¹„íŒë°›ê¸°ë„ í–ˆë‹µë‹ˆë‹¤.',era:'ì¡°ì„  í›„ê¸°'},
  kim_ok_gyun:{emoji:'ğŸ”¥',name:'ê¹€ì˜¥ê· ',desc:'ê°‘ì‹ ì •ë³€ì„ ì¼ìœ¼í‚¨ ê°œí™”íŒŒ',detail:'ê¹€ì˜¥ê· ì€ ê°‘ì‹ ì •ë³€ì„ ì£¼ë„í•œ ê¸‰ì§„ê°œí™”íŒŒ ì¸ë¬¼ì´ì—ìš”. ì¼ë³¸ì˜ ë©”ì´ì§€ìœ ì‹ ì„ ë³¸ë°›ì•„ ì¡°ì„ ì„ ê·¼ëŒ€í™”í•˜ë ¤ í–ˆì§€ë§Œ ì‹¤íŒ¨í•˜ê³  ìƒí•˜ì´ì—ì„œ ì•”ì‚´ë‹¹í–ˆë‹µë‹ˆë‹¤.',era:'ê°œí™”ê¸°'},
  
  // ì¼ì œê°•ì ê¸° & í˜„ëŒ€
  an_jung_geun:{emoji:'ğŸ¯',name:'ì•ˆì¤‘ê·¼',desc:'ì´í†  íˆë¡œë¶€ë¯¸ë¥¼ ì²˜ë‹¨í•œ ë…ë¦½ìš´ë™ê°€',detail:'ì•ˆì¤‘ê·¼ì€ í•˜ì–¼ë¹ˆì—ì„œ ì¡°ì„ ì¹¨ëµì˜ ì›í‰ ì´í†  íˆë¡œë¶€ë¯¸ë¥¼ ì €ê²©í•œ ì˜ì‚¬ì˜ˆìš”. ë¤¼ìˆœ ê°ì˜¥ì—ì„œ "ë™ì–‘í‰í™”ë¡ "ì„ ì“°ë©° ì¡°ì„ ì˜ ë…ë¦½ ì˜ì§€ë¥¼ ë³´ì—¬ì¤¬ë‹µë‹ˆë‹¤!',era:'ì¼ì œê°•ì ê¸°'},
  yu_gwan_sun:{emoji:'ğŸŒ¸',name:'ìœ ê´€ìˆœ',desc:'3.1ìš´ë™ì˜ ìƒì§•ì´ ëœ ì—´ì‚¬',detail:'ìœ ê´€ìˆœì€ ì´í™”í•™ë‹¹ í•™ìƒìœ¼ë¡œ 3.1ìš´ë™ì— ì°¸ì—¬í–ˆë‹¤ê°€ ì²´í¬ëœ ë…ë¦½ìš´ë™ê°€ì˜ˆìš”. ê°ì˜¥ì—ì„œë„ ë§Œì„¸ë¥¼ ë¶€ë¥´ë©° ëê¹Œì§€ ì €í•­í•˜ë‹¤ 17ì„¸ì˜ ë‚˜ì´ë¡œ ìˆœêµ­í–ˆìŠµë‹ˆë‹¤.',era:'ì¼ì œê°•ì ê¸°'},
  kim_gu:{emoji:'ğŸ‡°ğŸ‡·',name:'ê¹€êµ¬',desc:'ì„ì‹œì •ë¶€ë¥¼ ì´ëˆ ë…ë¦½ìš´ë™ê°€',detail:'ë°±ë²” ê¹€êµ¬ëŠ” ëŒ€í•œë¯¼êµ­ì„ì‹œì •ë¶€ ì£¼ì„ìœ¼ë¡œ ê´‘ë³µê¹Œì§€ ë…ë¦½ìš´ë™ì„ ì´ëˆ ì§€ë„ìì˜ˆìš”. "ë‚´ê°€ ì›í•˜ëŠ” ìš°ë¦¬ë‚˜ë¼"ì—ì„œ ë¬¸í™”ê°•êµ­ì„ ê¿ˆê¿¨ë˜ ë¶„ì´ëë‹ˆë‹¤.',era:'ì¼ì œê°•ì ê¸°'},
  syngman_rhee:{emoji:'ğŸ©',name:'ì´ìŠ¹ë§Œ',desc:'ëŒ€í•œë¯¼êµ­ ì´ˆëŒ€ ëŒ€í†µë ¹',detail:'ì´ìŠ¹ë§Œì€ ëŒ€í•œë¯¼êµ­ ì´ˆëŒ€ ëŒ€í†µë ¹ìœ¼ë¡œ ì •ë¶€ìˆ˜ë¦½ê³¼ 6.25ì „ìŸì„ ê²ªì—ˆì–´ìš”. ë¯¸êµ­ì—ì„œ ë…ë¦½ìš´ë™ì„ í•˜ë©° ì™¸êµë…ë¦½ë¡ ì„ ì£¼ì¥í–ˆë˜ ì¸ë¬¼ì´ê¸°ë„ í•©ë‹ˆë‹¤.',era:'í˜„ëŒ€'},
  park_chung_hee:{emoji:'ğŸ­',name:'ë°•ì •í¬',desc:'ê²½ì œë°œì „ì„ ì´ëˆ ëŒ€í†µë ¹',detail:'ë°•ì •í¬ ëŒ€í†µë ¹ì€ 5.16 êµ°ì‚¬ì •ë³€ìœ¼ë¡œ ì§‘ê¶Œí•œ í›„ ê²½ì œê°œë°œ 5ê°œë…„ê³„íšìœ¼ë¡œ í•œêµ­ì„ ë†ì—…êµ­ì—ì„œ ê³µì—…êµ­ìœ¼ë¡œ ë³€í™”ì‹œì¼°ì–´ìš”. í•œê°•ì˜ ê¸°ì ì„ ì´ë£¬ ì£¼ì—­ì´ëë‹ˆë‹¤.',era:'í˜„ëŒ€'}
};

const STAGES = [
  {id:'prehistoric',name:'ì„ ì‚¬ì‹œëŒ€ & ê³ ì¡°ì„ ',emoji:'ğŸ—¿',desc:'êµ¬ì„ê¸°ë¶€í„° ê³ ì¡°ì„ ê¹Œì§€',unlocked:true,maxQuestions:10,persons:['gojoseon_king','dolmen_builder','iron_master','wiman']},
  {id:'samguk',name:'ì‚¼êµ­ì‹œëŒ€',emoji:'âš”ï¸',desc:'ê³ êµ¬ë ¤Â·ë°±ì œÂ·ì‹ ë¼ì˜ ê²½ìŸ',unlocked:false,maxQuestions:12,persons:['jumong','gwanggaeto','jangsu','onjo','geunchogo']},
  {id:'unified',name:'ë‚¨ë¶êµ­ì‹œëŒ€',emoji:'ğŸŒ…',desc:'í†µì¼ì‹ ë¼ì™€ ë°œí•´',unlocked:false,maxQuestions:10,persons:['munmu','wonhyo','uisang','dae_joyeong','jang_bogo']},
  {id:'goryeo',name:'ê³ ë ¤ì‹œëŒ€',emoji:'ğŸ°',desc:'ê³ ë ¤ì˜ ê±´êµ­ê³¼ ë°œì „',unlocked:false,maxQuestions:12,persons:['wang_geon','sejong_goryeo','seo_hui','gang_gam_chan','choi_chung_heon']},
  {id:'joseon_early',name:'ì¡°ì„  ì „ê¸°',emoji:'ğŸ“œ',desc:'ì¡°ì„  ê±´êµ­ê³¼ ë¬¸í™”ìœµì„±',unlocked:false,maxQuestions:12,persons:['yi_seong_gye','sejong','jang_yeong_sil','yi_hwang','yi_i']},
  {id:'joseon_late',name:'ì¡°ì„  í›„ê¸° & ê°œí™”ê¸°',emoji:'ğŸŒ¸',desc:'ì‹¤í•™ê³¼ ê°œí™”ìš´ë™',unlocked:false,maxQuestions:12,persons:['sejong_late','park_ji_won','hong_dae_yong','jeong_yag_yong','kim_ok_gyun']},
  {id:'modern',name:'ì¼ì œê°•ì ê¸° & í˜„ëŒ€',emoji:'ğŸ‡°ğŸ‡·',desc:'ë…ë¦½ìš´ë™ê³¼ í˜„ëŒ€ì‚¬',unlocked:false,maxQuestions:12,persons:['an_jung_geun','yu_guan_sun','kim_gu','syngman_rhee','park_chung_hee']}
];

const QUESTIONS = {
  prehistoric: [
    {id:1,type:'4choice',q:'ìš°ë¦¬ë‚˜ë¼ ìµœì´ˆì˜ êµ­ê°€ëŠ” ë¬´ì—‡ì¼ê¹Œìš”? ğŸ›ï¸',options:['ê³ êµ¬ë ¤','ë°±ì œ','ì‹ ë¼','ê³ ì¡°ì„ '],answer:3,person:'gojoseon_king',explain:'ê³ ì¡°ì„ ì€ ìš°ë¦¬ë‚˜ë¼ ìµœì´ˆì˜ êµ­ê°€ë¡œ, ë‹¨êµ°ì™•ê²€ì´ ì„¸ì› ë‹¤ê³  ì „í•´ì ¸ìš”!'},
    {id:2,type:'ox',q:'ê³ ì¸ëŒì€ ì²­ë™ê¸° ì‹œëŒ€ì˜ ë¬´ë¤ì´ë‹¤.',answer:true,person:'dolmen_builder',explain:'ê³ ì¸ëŒì€ ì²­ë™ê¸° ì‹œëŒ€ ì§€ë°°ì¸µì˜ ê±°ëŒ€í•œ ëŒë¬´ë¤ì´ì—ìš”!'},
    {id:3,type:'fill',q:'â—‹â—‹ê¸° ì‹œëŒ€ì—ëŠ” ë†ê¸°êµ¬ì™€ ë¬´ê¸°ê°€ ë”ìš± ë°œë‹¬í–ˆì–´ìš”.',answer:['ì² ','ì² ê¸°'],person:'iron_master',explain:'ì² ê¸°ì‹œëŒ€ê°€ ë˜ë©´ì„œ ì² ë¡œ ë§Œë“  ë„êµ¬ë“¤ì´ ë„ë¦¬ ì‚¬ìš©ë˜ì—ˆì–´ìš”!'},
    {id:4,type:'4choice',q:'ê³ ì¡°ì„ ì„ ë©¸ë§ì‹œí‚¨ ì¤‘êµ­ì˜ ë‚˜ë¼ëŠ”?',options:['ì§„ë‚˜ë¼','í•œë‚˜ë¼','ë‹¹ë‚˜ë¼','ì†¡ë‚˜ë¼'],answer:1,person:'wiman',explain:'í•œë‚˜ë¼ ë¬´ì œê°€ ê³ ì¡°ì„ ì„ ê³µê²©í•˜ì—¬ ë©¸ë§ì‹œì¼°ì–´ìš”.'},
    {id:5,type:'ox',q:'ë‹¨êµ°ì™•ê²€ì€ ì‹¤ì¡´ ì¸ë¬¼ì´ë‹¤.',answer:false,person:'gojoseon_king',explain:'ë‹¨êµ°ì™•ê²€ì€ ì „ì„¤ ì† ì¸ë¬¼ì´ì§€ë§Œ, ìš°ë¦¬ ë¯¼ì¡±ì˜ ì‹œì¡°ë¡œ ì—¬ê²¨ì ¸ìš”!'},
    {id:6,type:'order',q:'ë‹¤ìŒì„ ì‹œëŒ€ ìˆœì„œëŒ€ë¡œ ë°°ì—´í•˜ì„¸ìš”!',items:['êµ¬ì„ê¸°','ì‹ ì„ê¸°','ì²­ë™ê¸°','ì² ê¸°'],correctOrder:[0,1,2,3],person:'iron_master',explain:'êµ¬ì„ê¸° â†’ ì‹ ì„ê¸° â†’ ì²­ë™ê¸° â†’ ì² ê¸° ìˆœì„œë¡œ ë°œì „í–ˆì–´ìš”!'},
    {id:7,type:'4choice',q:'ë¹„íŒŒí˜• ë™ê²€ì€ ì–´ëŠ ì‹œëŒ€ì˜ ëŒ€í‘œì ì¸ ìœ ë¬¼ì¸ê°€ìš”?',options:['ì‹ ì„ê¸°','ì²­ë™ê¸°','ì² ê¸°','ì‚¼êµ­ì‹œëŒ€'],answer:1,person:'dolmen_builder',explain:'ë¹„íŒŒí˜• ë™ê²€ì€ ì²­ë™ê¸° ì‹œëŒ€ ê³ ì¡°ì„ ì˜ ëŒ€í‘œì ì¸ ì²­ë™ ìœ ë¬¼ì´ì—ìš”!'},
    {id:8,type:'fill',q:'ê³ ì¡°ì„ ì˜ ë²• ì¤‘ ë‚¨ì˜ ë¬¼ê±´ì„ í›”ì¹˜ë©´ â—‹â—‹ë°°ë¥¼ ê°šì•„ì•¼ í–ˆì–´ìš”.',answer:['12','ì‹­ì´'],person:'gojoseon_king',explain:'8ì¡°ë²•ì—ì„œ ë„ë‘‘ì§ˆí•˜ë©´ 12ë°°ë¥¼ ë°°ìƒí•˜ë„ë¡ í–ˆì–´ìš”!'},
    {id:9,type:'ox',q:'ìœ„ë§Œì€ ê³ ì¡°ì„  ì‚¬ëŒì´ë‹¤.',answer:false,person:'wiman',explain:'ìœ„ë§Œì€ ì¤‘êµ­ ì—°ë‚˜ë¼ì—ì„œ ì˜¨ ë§ëª…ê°ì´ì—ˆì–´ìš”!'},
    {id:10,type:'4choice',q:'ë¹—ì‚´ë¬´ëŠ¬í† ê¸°ëŠ” ì–´ëŠ ì‹œëŒ€ì˜ ëŒ€í‘œ ìœ ë¬¼ì¸ê°€ìš”?',options:['êµ¬ì„ê¸°','ì‹ ì„ê¸°','ì²­ë™ê¸°','ì² ê¸°'],answer:1,person:'dolmen_builder',explain:'ë¹—ì‚´ë¬´ëŠ¬í† ê¸°ëŠ” ì‹ ì„ê¸° ì‹œëŒ€ì˜ ëŒ€í‘œì ì¸ í† ê¸°ì˜ˆìš”!'}
  ],
  samguk: [
    {id:1,type:'4choice',q:'ê³ êµ¬ë ¤ë¥¼ ì„¸ìš´ ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”? ğŸ¹',options:['ì£¼ëª½','ì˜¨ì¡°','í˜ê±°ì„¸','ê¹€ìˆ˜ë¡œ'],answer:0,person:'jumong',explain:'ì£¼ëª½ì€ ë¶€ì—¬ì—ì„œ ë‚´ë ¤ì™€ ê³ êµ¬ë ¤ë¥¼ ì„¸ì› ì–´ìš”. í™œì„ ì˜ ì´ì„œ "ì£¼ëª½"ì´ë¼ëŠ” ì´ë¦„ì´ ë¶™ì—ˆë‹µë‹ˆë‹¤!'},
    {id:2,type:'4choice',q:'ë°±ì œë¥¼ ì„¸ìš´ ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?',options:['ë°•í˜ê±°ì„¸','ê¹€ìˆ˜ë¡œ','ì˜¨ì¡°','ì£¼ëª½'],answer:2,person:'onjo',explain:'ì˜¨ì¡°ëŠ” ì£¼ëª½ì˜ ì•„ë“¤ë¡œ, ë‚¨ìª½ìœ¼ë¡œ ë‚´ë ¤ì™€ ìœ„ë¡€ì„±ì— ë°±ì œë¥¼ ì„¸ì› ì–´ìš”.'},
    {id:3,type:'ox',q:'ê´‘ê°œí† ëŒ€ì™•ì€ ì‹ ë¼ì˜ ì™•ì´ë‹¤.',answer:false,person:'gwanggaeto',explain:'ê´‘ê°œí† ëŒ€ì™•ì€ ê³ êµ¬ë ¤ì˜ ì™•ì´ì—ìš”! ê³ êµ¬ë ¤ì˜ ì˜í† ë¥¼ í¬ê²Œ ë„“íŒ ìœ„ëŒ€í•œ ì™•ì´ëë‹ˆë‹¤.'},
    {id:4,type:'4choice',q:'ì‹ ë¼ì—ì„œ ë§Œë“ , ë³„ì„ ê´€ì°°í•˜ëŠ” ê±´ë¬¼ì˜ ì´ë¦„ì€?',options:['ì„êµ´ì•”','ì²¨ì„±ëŒ€','í™©ë£¡ì‚¬','ë¶ˆêµ­ì‚¬'],answer:1,person:'munmu',explain:'ì²¨ì„±ëŒ€ëŠ” ì„ ë•ì—¬ì™• ë•Œ ë§Œë“¤ì–´ì§„ ë™ì–‘ì—ì„œ ê°€ì¥ ì˜¤ë˜ëœ ì²œë¬¸ ê´€ì¸¡ëŒ€ì˜ˆìš”! â­'},
    {id:5,type:'4choice',q:'ê³ êµ¬ë ¤ ì¥ìˆ˜ì™•ì´ ìˆ˜ë„ë¥¼ ì˜®ê¸´ ê³³ì€ ì–´ë””ì¼ê¹Œìš”?',options:['í•œì–‘','êµ­ë‚´ì„±','í‰ì–‘','ë¶€ì—¬'],answer:2,person:'jangsu',explain:'ì¥ìˆ˜ì™•ì€ ìˆ˜ë„ë¥¼ êµ­ë‚´ì„±ì—ì„œ í‰ì–‘ìœ¼ë¡œ ì˜®ê²¨ ë‚¨ìª½ìœ¼ë¡œ ì˜í† ë¥¼ ë„“íˆë ¤ í–ˆì–´ìš”.'},
    {id:6,type:'ox',q:'ì„ì§€ë¬¸ë•ì€ ë°±ì œì˜ ì¥êµ°ì´ë‹¤.',answer:false,person:'gwanggaeto',explain:'ì„ì§€ë¬¸ë•ì€ ê³ êµ¬ë ¤ì˜ ì¥êµ°ìœ¼ë¡œ ì‚´ìˆ˜ëŒ€ì²©ì˜ ì˜ì›…ì´ì—ìš”!'},
    {id:7,type:'order',q:'ë‹¤ìŒ ë‚˜ë¼ê°€ ì„¸ì›Œì§„ ìˆœì„œëŒ€ë¡œ ë†“ì•„ë³´ì„¸ìš”! ğŸ¯',items:['ê³ êµ¬ë ¤','ë°±ì œ','ì‹ ë¼','ê°€ì•¼'],correctOrder:[0,1,2,3],person:'jumong',explain:'ê³ êµ¬ë ¤(BC 37) â†’ ë°±ì œ(BC 18) â†’ ì‹ ë¼(BC 57ì´ì§€ë§Œ ë°œì „ì€ ëŠ¦ìŒ) â†’ ê°€ì•¼(42). ì‚¼êµ­ ì¤‘ ê³ êµ¬ë ¤ê°€ ê°€ì¥ ë¨¼ì € ì„¸ì›Œì¡Œì–´ìš”!'},
    {id:8,type:'4choice',q:'ë°±ì œì˜ ì „ì„±ê¸°ë¥¼ ì´ëˆ ì™•ìœ¼ë¡œ, ë§ˆí•œì„ í†µí•©í•œ ì™•ì€?',options:['ì˜ìì™•','ë¬´ë ¹ì™•','ê·¼ì´ˆê³ ì™•','ì„±ì™•'],answer:2,person:'geunchogo',explain:'ê·¼ì´ˆê³ ì™•ì€ ë§ˆí•œ ì „ì²´ë¥¼ í†µí•©í•˜ê³  í•´ì™¸ê¹Œì§€ ì§„ì¶œí•œ ë°±ì œ ì „ì„±ê¸°ì˜ ì™•ì´ì—ìš”! ğŸ›¡ï¸'},
    {id:9,type:'fill',q:'ê³ êµ¬ë ¤, ë°±ì œ, ì‹ ë¼ë¥¼ í•©ì³ì„œ "â—‹â—‹"ì´ë¼ê³  ë¶ˆëŸ¬ìš”.',answer:['ì‚¼êµ­','ì‚¼êµ­ì‹œëŒ€'],person:'jumong',explain:'ê³ êµ¬ë ¤Â·ë°±ì œÂ·ì‹ ë¼ ì„¸ ë‚˜ë¼ë¥¼ í•©ì³ "ì‚¼êµ­"ì´ë¼ê³  ë¶€ë¥´ê³ , ì´ ì‹œê¸°ë¥¼ ì‚¼êµ­ì‹œëŒ€ë¼ê³  í•´ìš”!'},
    {id:10,type:'ox',q:'ê´‘ê°œí† ëŒ€ì™•ë¦‰ë¹„ëŠ” ë°±ì œì— ìˆë‹¤.',answer:false,person:'gwanggaeto',explain:'ê´‘ê°œí† ëŒ€ì™•ë¦‰ë¹„ëŠ” ì§€ê¸ˆì˜ ì¤‘êµ­ ì§€ë¦°ì„±(ë§Œì£¼)ì— ìˆì–´ìš”. ê³ êµ¬ë ¤ ì˜í† ì˜€ë˜ ê³³ì´ëë‹ˆë‹¤!'},
    {id:11,type:'4choice',q:'ê°€ì•¼ì˜ ì‹œì¡°ëŠ” ëˆ„êµ¬ì¸ê°€ìš”?',options:['ë°•í˜ê±°ì„¸','ê¹€ìˆ˜ë¡œ','ì˜¨ì¡°','ì£¼ëª½'],answer:1,person:'onjo',explain:'ê¹€ìˆ˜ë¡œì™•ì€ ê°€ì•¼(ê¸ˆê´€ê°€ì•¼)ì˜ ì‹œì¡°ë¡œ ì „í•´ì ¸ìš”!'},
    {id:12,type:'4choice',q:'í•œê°• ìœ ì—­ì„ ì°¨ì§€í•œ ì‹ ë¼ì˜ ì™•ì€?',options:['ë‚´ë¬¼ì™•','ëˆŒì§€ì™•','ì§„í¥ì™•','ì§„í‰ì™•'],answer:2,person:'munmu',explain:'ì§„í¥ì™•ì€ í•œê°• ìœ ì—­ì„ ì°¨ì§€í•˜ê³  ìˆœìˆ˜ë¹„ë¥¼ ì„¸ì› ì–´ìš”!'}
  ],
  unified: [
    {id:1,type:'4choice',q:'ì‚¼êµ­í†µì¼ì„ ì™„ì„±í•œ ì‹ ë¼ì˜ ì™•ì€?',options:['ë¬´ì—´ì™•','ë¬¸ë¬´ì™•','ì‹ ë¬¸ì™•','ì§„í‰ì™•'],answer:1,person:'munmu',explain:'ë¬¸ë¬´ì™•ì´ ë°±ì œì™€ ê³ êµ¬ë ¤ë¥¼ ë©¸ë§ì‹œí‚¤ê³  ë‹¹ë‚˜ë¼ê¹Œì§€ ì¶•ì¶œí•˜ì—¬ ì‚¼êµ­í†µì¼ì„ ì™„ì„±í–ˆì–´ìš”!'},
    {id:2,type:'4choice',q:'ë°œí•´ë¥¼ ê±´êµ­í•œ ì‚¬ëŒì€?',options:['ì—°ê°œì†Œë¬¸','ëŒ€ì¡°ì˜','ê¶ì˜ˆ','ê²¬í›¤'],answer:1,person:'dae_joyeong',explain:'ëŒ€ì¡°ì˜ì´ ê³ êµ¬ë ¤ ìœ ë¯¼ê³¼ ë§ê°ˆì¡±ì„ ì´ëŒê³  ë°œí•´ë¥¼ ê±´êµ­í–ˆì–´ìš”!'},
    {id:3,type:'ox',q:'ì›íš¨ëŒ€ì‚¬ëŠ” ë¶ˆêµë¥¼ ì–´ë µê²Œë§Œ ê°€ë¥´ì³¤ë‹¤.',answer:false,person:'wonhyo',explain:'ì›íš¨ëŒ€ì‚¬ëŠ” ì–´ë ¤ìš´ ë¶ˆêµë¥¼ ì¼ë°˜ ë°±ì„±ë“¤ë„ ì‰½ê²Œ ì´í•´í•˜ë„ë¡ ëŒ€ì¤‘í™”í–ˆì–´ìš”!'},
    {id:4,type:'4choice',q:'ë°œí•´ì˜ ì „ì„±ê¸°ë¥¼ ì´ë£¬ ì™•ì€?',options:['ëŒ€ì¡°ì˜','ëŒ€ë¬´ì˜ˆ','ëŒ€ì¸ìˆ˜','ì„ ì™•'],answer:3,person:'dae_joyeong',explain:'ì„ ì™• ë•Œ ë°œí•´ëŠ” "í•´ë™ì„±êµ­"ì´ë¼ ë¶ˆë¦´ ì •ë„ë¡œ ì „ì„±ê¸°ë¥¼ ëˆ„ë ¸ì–´ìš”!'},
    {id:5,type:'fill',q:'ì²­í•´ì§„ì„ ì„¤ì¹˜í•˜ê³  í•´ìƒë¬´ì—­ì„ ì¥ì•…í•œ ì¸ë¬¼ì€ â—‹â—‹â—‹ì´ì—ìš”.',answer:['ì¥ë³´ê³ '],person:'jang_bogo',explain:'ì¥ë³´ê³ ëŠ” ì²­í•´ì§„ì„ ê·¼ê±°ì§€ë¡œ ë™ì•„ì‹œì•„ í•´ìƒë¬´ì—­ì„ ì¥ì•…í•œ í•´ìƒì™•ì´ì—ˆì–´ìš”!'},
    {id:6,type:'ox',q:'í†µì¼ì‹ ë¼ëŠ” í•œë°˜ë„ ì „ì²´ë¥¼ ì°¨ì§€í–ˆë‹¤.',answer:false,person:'munmu',explain:'í†µì¼ì‹ ë¼ëŠ” ëŒ€ë™ê°• ì´ë‚¨ë§Œ ì°¨ì§€í–ˆê³ , ì´ë¶ì€ ë°œí•´ê°€ ì°¨ì§€í–ˆì–´ìš”!'},
    {id:7,type:'4choice',q:'í™”ì—„ì‚¬ìƒì„ ì „íŒŒí•œ ê³ ìŠ¹ì€?',options:['ì›íš¨','ì˜ìƒ','í˜œì´ˆ','ìì¥'],answer:1,person:'uisang',explain:'ì˜ìƒëŒ€ì‚¬ëŠ” ë‹¹ë‚˜ë¼ì—ì„œ í™”ì—„ì‚¬ìƒì„ ë°°ì›Œì™€ ì „íŒŒí–ˆì–´ìš”!'},
    {id:8,type:'order',q:'ë‹¤ìŒ ì‹ ë¼ ì™•ë“¤ì„ ìˆœì„œëŒ€ë¡œ ë°°ì—´í•˜ì„¸ìš”!',items:['ë¬´ì—´ì™•','ë¬¸ë¬´ì™•','ì‹ ë¬¸ì™•','ì„±ë•ì™•'],correctOrder:[0,1,2,3],person:'munmu',explain:'ë¬´ì—´ì™• â†’ ë¬¸ë¬´ì™• â†’ ì‹ ë¬¸ì™• â†’ ì„±ë•ì™• ìˆœìœ¼ë¡œ í†µì¼ì‹ ë¼ ì´ˆê¸°ë¥¼ ì´ëŒì—ˆì–´ìš”!'},
    {id:9,type:'ox',q:'ë°œí•´ëŠ” ê³ êµ¬ë ¤ë¥¼ ê³„ìŠ¹í•œ ë‚˜ë¼ì´ë‹¤.',answer:true,person:'dae_joyeong',explain:'ë°œí•´ëŠ” ê³ êµ¬ë ¤ ìœ ë¯¼ì´ ì„¸ìš´ ë‚˜ë¼ë¡œ ê³ êµ¬ë ¤ë¥¼ ê³„ìŠ¹í–ˆë‹¤ê³  ì—¬ê²¨ì ¸ìš”!'},
    {id:10,type:'4choice',q:'ë¶ˆêµ­ì‚¬ì™€ ì„êµ´ì•”ì„ ë§Œë“  ì‹ ë¼ì˜ ì¬ìƒì€?',options:['ê¹€ìœ ì‹ ','ê¹€ì¶˜ì¶”','ê¹€ëŒ€ì„±','ì¥ë³´ê³ '],answer:2,person:'munmu',explain:'ê¹€ëŒ€ì„±ì´ ë¶ˆêµ­ì‚¬ì™€ ì„êµ´ì•” ê±´ë¦½ì„ ì£¼ë„í–ˆì–´ìš”!'}
  ],
  goryeo: [
    {id:1,type:'4choice',q:'ê³ ë ¤ë¥¼ ê±´êµ­í•œ ì‚¬ëŒì€?',options:['ê¶ì˜ˆ','ê²¬í›¤','ì™•ê±´','ê¸°ì¤€'],answer:2,person:'wang_geon',explain:'ì™•ê±´ì´ í›„ì‚¼êµ­ì„ í†µì¼í•˜ê³  ê³ ë ¤ë¥¼ ê±´êµ­í–ˆì–´ìš”!'},
    {id:2,type:'4choice',q:'ê±°ë€ì˜ ì¹¨ì…ì„ ì™¸êµë¡œ í•´ê²°í•œ ì¸ë¬¼ì€?',options:['ì„œí¬','ê°•ê°ì°¬','ìœ¤ê´€','ê¹€ë¶€ì‹'],answer:0,person:'seo_hui',explain:'ì„œí¬ê°€ ì†Œì†ë…•ê³¼ì˜ ë‹´íŒìœ¼ë¡œ ê±°ë€ 1ì°¨ ì¹¨ì…ì„ ë§‰ê³  ê°•ë™ 6ì£¼ë¥¼ ì–»ì—ˆì–´ìš”!'},
    {id:3,type:'4choice',q:'ê·€ì£¼ëŒ€ì²©ì˜ ì˜ì›…ì€?',options:['ì„ì§€ë¬¸ë•','ì—°ê°œì†Œë¬¸','ê°•ê°ì°¬','ìœ¤ê´€'],answer:2,person:'gang_gam_chan',explain:'ê°•ê°ì°¬ì´ ê·€ì£¼ëŒ€ì²©ì—ì„œ ê±°ë€êµ°ì„ í¬ê²Œ ë¬¼ë¦¬ì³¤ì–´ìš”!'},
    {id:4,type:'ox',q:'ê³ ë ¤ëŠ” ë¶ˆêµ êµ­ê°€ì˜€ë‹¤.',answer:true,person:'wang_geon',explain:'ê³ ë ¤ëŠ” ë¶ˆêµë¥¼ êµ­êµë¡œ í•˜ëŠ” ë¶ˆêµ êµ­ê°€ì˜€ì–´ìš”!'},
    {id:5,type:'4choice',q:'ë¬´ì‹ ì •ë³€ì˜ ì¤‘ì‹¬ì¸ë¬¼ì€?',options:['ì •ì¤‘ë¶€','ì´ì˜ë°©','ìµœì¶©í—Œ','ê²½ëŒ€ìŠ¹'],answer:2,person:'choi_chung_heon',explain:'ìµœì¶©í—Œì´ ë¬´ì‹ ì •ë³€ì„ ì£¼ë„í•˜ê³  ë¬´ì‹ ì •ê¶Œì„ í™•ë¦½í–ˆì–´ìš”!'},
    {id:6,type:'fill',q:'ê³ ë ¤ì˜ ìˆ˜ë„ëŠ” â—‹â—‹ì´ì—ˆì–´ìš”.',answer:['ê°œê²½','ê°œì„±'],person:'wang_geon',explain:'ê³ ë ¤ì˜ ìˆ˜ë„ëŠ” ê°œê²½(ì§€ê¸ˆì˜ ê°œì„±)ì´ì—ˆì–´ìš”!'},
    {id:7,type:'4choice',q:'ê³ êµ¬ë ¤ ë¶€í¥ì„ ê¿ˆê¾¸ë©° í›„ê³ êµ¬ë ¤ë¥¼ ì„¸ìš´ ì¸ë¬¼ì€?',options:['ê¶ì˜ˆ','ê²¬í›¤','ì–‘ê¸¸','ê¸°ì¤€'],answer:0,person:'wang_geon',explain:'ê¶ì˜ˆê°€ í›„ê³ êµ¬ë ¤(ë‚˜ì¤‘ì— ë§ˆì§„, íƒœë´‰)ë¥¼ ì„¸ì› ì–´ìš”!'},
    {id:8,type:'ox',q:'ê³ ë ¤ëŠ” ëª½ê³¨(ì›)ì˜ ì¹¨ì…ì„ ì™„ì „íˆ ë§‰ì•„ëƒˆë‹¤.',answer:false,person:'choi_chung_heon',explain:'ê³ ë ¤ëŠ” ëª½ê³¨ ì¹¨ì…ì— ê°•í™”ë„ë¡œ í”¼ë‚œí–ˆê³ , ê²°êµ­ ì›ì˜ ì†êµ­ì´ ë˜ì—ˆì–´ìš”.'},
    {id:9,type:'4choice',q:'ê³ ë ¤ ê´‘ì¢…ì´ ì‹¤ì‹œí•œ ì •ì±…ì€?',options:['ê³¼ê±°ì œ ë„ì…','ë…¸ì˜ˆì•ˆê²€ë²•','ì—°ë¶„9ë“±ë²•','ë…¹ì íì§€'],answer:1,person:'sejong_goryeo',explain:'ê´‘ì¢…ì€ ë…¸ì˜ˆì•ˆê²€ë²•ìœ¼ë¡œ í˜¸ì¡± ì„¸ë ¥ì„ ì•½í™”ì‹œì¼°ì–´ìš”!'},
    {id:10,type:'order',q:'ê³ ë ¤ ì „ê¸° ê±°ë€ ì¹¨ì… ìˆœì„œëŒ€ë¡œ ë°°ì—´í•˜ì„¸ìš”!',items:['1ì°¨ ì¹¨ì…','2ì°¨ ì¹¨ì…','3ì°¨ ì¹¨ì…'],correctOrder:[0,1,2],person:'seo_hui',explain:'993ë…„ 1ì°¨, 1010ë…„ 2ì°¨, 1018ë…„ 3ì°¨ ì¹¨ì…ì´ ìˆì—ˆì–´ìš”!'},
    {id:11,type:'ox',q:'íŒ”ë§ŒëŒ€ì¥ê²½ì€ ê³ ë ¤ì‹œëŒ€ì— ë§Œë“¤ì–´ì¡Œë‹¤.',answer:true,person:'wang_geon',explain:'íŒ”ë§ŒëŒ€ì¥ê²½(ì¬ì¡°ëŒ€ì¥ê²½)ì€ ëª½ê³¨ ì¹¨ì… ë•Œ ë¶€ì²˜ì˜ í˜ì„ ë¹Œë¦¬ë ¤ê³  ë§Œë“¤ì—ˆì–´ìš”!'},
    {id:12,type:'4choice',q:'ë™ë¶ 9ì„±ì„ ìŒ“ì€ ê³ ë ¤ì˜ ì¥êµ°ì€?',options:['ì„œí¬','ê°•ê°ì°¬','ìœ¤ê´€','ê¹€ë¶€ì‹'],answer:2,person:'gang_gam_chan',explain:'ìœ¤ê´€ì´ ë³„ë¬´ë°˜ì„ ì´ëŒê³  ì—¬ì§„ì¡±ì„ ë¬¼ë¦¬ì¹˜ê³  ë™ë¶ 9ì„±ì„ ìŒ“ì•˜ì–´ìš”!'}
  ],
  joseon_early: [
    {id:1,type:'4choice',q:'ì¡°ì„ ì„ ê±´êµ­í•œ ì‚¬ëŒì€?',options:['ì •ë„ì „','í•˜ë¥œ','ì´ì„±ê³„','ì¡°ì¤€'],answer:2,person:'yi_seong_gye',explain:'ì´ì„±ê³„ê°€ ìœ„í™”ë„ íšŒêµ° í›„ ì¡°ì„ ì„ ê±´êµ­í–ˆì–´ìš”!'},
    {id:2,type:'4choice',q:'í•œê¸€ì„ ì°½ì œí•œ ì™•ì€?',options:['íƒœì¡°','ì„¸ì¢…','ë¬¸ì¢…','ë‹¨ì¢…'],answer:1,person:'sejong',explain:'ì„¸ì¢…ëŒ€ì™•ì´ ë°±ì„±ì„ ìœ„í•´ í›ˆë¯¼ì •ìŒ(í•œê¸€)ì„ ì°½ì œí–ˆì–´ìš”!'},
    {id:3,type:'4choice',q:'ì¡°ì„  ìµœê³ ì˜ ê³¼í•™ê¸°ìˆ ìëŠ”?',options:['ì¥ì˜ì‹¤','ê¹€ì •í˜¸','ì´ìˆœì‹ ','í—ˆì¤€'],answer:0,person:'jang_yeong_sil',explain:'ì¥ì˜ì‹¤ì€ ë¬¼ì‹œê³„, í•´ì‹œê³„, ì¸¡ìš°ê¸° ë“±ì„ ë§Œë“  ê³¼í•™ê¸°ìˆ ìì˜€ì–´ìš”!'},
    {id:4,type:'ox',q:'ê²½ë³µê¶ì€ ì¡°ì„  ì´ˆê¸°ì— ì§€ì–´ì§„ ê¶ê¶ì´ë‹¤.',answer:true,person:'yi_seong_gye',explain:'ê²½ë³µê¶ì€ ì¡°ì„  íƒœì¡° ë•Œ ì§€ì–´ì§„ ì¡°ì„ ì˜ ë²•ê¶ì´ì—ìš”!'},
    {id:5,type:'4choice',q:'ì„±ë¦¬í•™ì˜ ëŒ€ê°€ í‡´ê³„ëŠ”?',options:['ì´í™©','ì´ì´','ì¡°ì‹','ì„œê²½ë•'],answer:0,person:'yi_hwang',explain:'í‡´ê³„ ì´í™©ì€ "ë™ë°©ì˜ ì£¼ì"ë¼ ë¶ˆë¦° ì„±ë¦¬í•™ì˜ ëŒ€ê°€ì˜ˆìš”!'},
    {id:6,type:'fill',q:'ì¡°ì„  ì „ê¸° â—‹â—‹ì˜ ë³€ìœ¼ë¡œ ê³„ìœ ì •ë‚œì´ ì¼ì–´ë‚¬ì–´ìš”.',answer:['ë‹¨ì¢…','ê³„ìœ '],person:'sejong',explain:'ì„¸ì¡°ê°€ ë‹¨ì¢…ì„ ëª°ì•„ë‚´ê³  ì™•ìœ„ë¥¼ ì°¨ì§€í•œ ì‚¬ê±´ì´ ê³„ìœ ì •ë‚œì´ì—ìš”!'},
    {id:7,type:'4choice',q:'ì‹¤ìš©ì  ê°œí˜ì„ ì£¼ì¥í•œ ìœ¨ê³¡ì€?',options:['ì´í™©','ì´ì´','ì¡°ì‹','ì„œê²½ë•'],answer:1,person:'yi_i',explain:'ìœ¨ê³¡ ì´ì´ëŠ” ì‹­ë§Œì–‘ë³‘ì„¤ ë“± ì‹¤ìš©ì  ê°œí˜ì„ ì£¼ì¥í–ˆì–´ìš”!'},
    {id:8,type:'ox',q:'í›ˆë¯¼ì •ìŒì€ ì²˜ìŒì— ëª¨ë“  ì‚¬ëŒì´ í™˜ì˜í–ˆë‹¤.',answer:false,person:'sejong',explain:'í›ˆë¯¼ì •ìŒì€ ì²˜ìŒì—” ì–‘ë°˜ë“¤ì˜ ë°˜ëŒ€ê°€ ì‹¬í–ˆì–´ìš”!'},
    {id:9,type:'order',q:'ì¡°ì„  ì „ê¸° ì™•ë“¤ì„ ìˆœì„œëŒ€ë¡œ ë°°ì—´í•˜ì„¸ìš”!',items:['íƒœì¡°','íƒœì¢…','ì„¸ì¢…','ë¬¸ì¢…'],correctOrder:[0,1,2,3],person:'yi_seong_gye',explain:'íƒœì¡° â†’ íƒœì¢… â†’ ì„¸ì¢… â†’ ë¬¸ì¢… ìˆœì„œì˜ˆìš”!'},
    {id:10,type:'4choice',q:'ì¡°ì„ ì˜ ìˆ˜ë„ëŠ”?',options:['ê°œì„±','í‰ì–‘','í•œì–‘','ë¶€ì—¬'],answer:2,person:'yi_seong_gye',explain:'ì¡°ì„ ì˜ ìˆ˜ë„ëŠ” í•œì–‘(ì§€ê¸ˆì˜ ì„œìš¸)ì´ì—ˆì–´ìš”!'},
    {id:11,type:'ox',q:'ì§‘í˜„ì „ì€ ì„¸ì¢… ë•Œ ì„¤ì¹˜ë˜ì—ˆë‹¤.',answer:true,person:'sejong',explain:'ì§‘í˜„ì „ì€ ì„¸ì¢…ì´ í•™ë¬¸ ì—°êµ¬ë¥¼ ìœ„í•´ ì„¤ì¹˜í•œ ê¸°ê´€ì´ì—ìš”!'},
    {id:12,type:'4choice',q:'ì¡°ì„  ê±´êµ­ì— í° ì—­í• ì„ í•œ í•™ìëŠ”?',options:['ì •ë„ì „','ê¶Œê·¼','í•˜ë¥œ','ì¡°ì¤€'],answer:0,person:'yi_seong_gye',explain:'ì •ë„ì „ì€ ì¡°ì„  ê±´êµ­ì˜ ì„¤ê³„ìë¡œ ë¶ˆë ¤ìš”!'}
  ],
  joseon_late: [
    {id:1,type:'4choice',q:'ê·œì¥ê°ì„ ì„¤ì¹˜í•œ ì¡°ì„  í›„ê¸° ì™•ì€?',options:['ì˜ì¡°','ì •ì¡°','ìˆœì¡°','í—Œì¢…'],answer:1,person:'sejong_late',explain:'ì •ì¡°ê°€ ê·œì¥ê°ì„ ì„¤ì¹˜í•˜ê³  ë¬¸ì˜ˆë¶€í¥ì„ ì´ëŒì—ˆì–´ìš”!'},
    {id:2,type:'4choice',q:'ì—´í•˜ì¼ê¸°ë¥¼ ì“´ ì‹¤í•™ìëŠ”?',options:['ë°•ì§€ì›','í™ëŒ€ìš©','ì •ì•½ìš©','ê¹€ì •í¬'],answer:0,person:'park_ji_won',explain:'ì—°ì•” ë°•ì§€ì›ì´ ì—´í•˜ì¼ê¸°ë¥¼ ì¨ì„œ ì¡°ì„ ì˜ ë°œì „ ë°©í–¥ì„ ì œì‹œí–ˆì–´ìš”!'},
    {id:3,type:'4choice',q:'ì§€êµ¬ê°€ ë‘¥ê¸€ë‹¤ê³  ì£¼ì¥í•œ ì‹¤í•™ìëŠ”?',options:['ë°•ì§€ì›','í™ëŒ€ìš©','ì •ì•½ìš©','ê¹€ì •í¬'],answer:1,person:'hong_dae_yong',explain:'ë‹´í—Œ í™ëŒ€ìš©ì´ ì§€ì „ì„¤ì„ ì£¼ì¥í•˜ê³  ì˜ì‚°ë¬¸ë‹µì„ ì¼ì–´ìš”!'},
    {id:4,type:'4choice',q:'ëª©ë¯¼ì‹¬ì„œë¥¼ ì“´ ì‹¤í•™ìëŠ”?',options:['ë°•ì§€ì›','í™ëŒ€ìš©','ì •ì•½ìš©','ê¹€ì •í¬'],answer:2,person:'jeong_yag_yong',explain:'ë‹¤ì‚° ì •ì•½ìš©ì´ ëª©ë¯¼ì‹¬ì„œì™€ ê²½ì„¸ìœ í‘œë¥¼ ì¼ì–´ìš”!'},
    {id:5,type:'ox',q:'í¥ì„ ëŒ€ì›êµ°ì€ ê°œí™”ì •ì±…ì„ í¼ì³¤ë‹¤.',answer:false,person:'heungseon',explain:'í¥ì„ ëŒ€ì›êµ°ì€ ì‡„êµ­ì •ì±…ì„ í¼ì³ ê°œí™”ë¥¼ ë°˜ëŒ€í–ˆì–´ìš”!'},
    {id:6,type:'4choice',q:'ê°‘ì‹ ì •ë³€ì„ ì¼ìœ¼í‚¨ ê°œí™”íŒŒ ì¸ë¬¼ì€?',options:['ê¹€ì˜¥ê· ','ë°•ì˜íš¨','ì„œì¬í•„','ìœ ê¸¸ì¤€'],answer:0,person:'kim_ok_gyun',explain:'ê¹€ì˜¥ê· ì´ ê°‘ì‹ ì •ë³€ì„ ì£¼ë„í–ˆì§€ë§Œ 3ì¼ ë§Œì— ì‹¤íŒ¨í–ˆì–´ìš”!'},
    {id:7,type:'fill',q:'ì¡°ì„  í›„ê¸° ì²œì£¼êµë¥¼ â—‹â—‹êµë¼ê³ ë„ ë¶ˆë €ì–´ìš”.',answer:['ì„œí•™'],person:'jeong_yag_yong',explain:'ì²œì£¼êµë¥¼ ì„œí•™ì´ë¼ê³  ë¶ˆë €ê³ , ì •ì•½ìš© ê°€ì¡±ë„ ì‹ ì•™í–ˆì–´ìš”!'},
    {id:8,type:'ox',q:'ì‹¤í•™ì€ í˜„ì‹¤ ê°œí˜ì„ ì¶”êµ¬í•˜ëŠ” í•™ë¬¸ì´ë‹¤.',answer:true,person:'park_ji_won',explain:'ì‹¤í•™ì€ í˜„ì‹¤ì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ëŠ” ì‹¤ìš©ì  í•™ë¬¸ì´ì—ˆì–´ìš”!'},
    {id:9,type:'4choice',q:'ìˆ˜ì› í™”ì„±ì„ ì¶•ì¡°í•œ ì™•ì€?',options:['ì˜ì¡°','ì •ì¡°','ìˆœì¡°','ê³ ì¢…'],answer:1,person:'sejong_late',explain:'ì •ì¡°ê°€ ì•„ë²„ì§€ ì‚¬ë„ì„¸ìë¥¼ ìœ„í•´ ìˆ˜ì› í™”ì„±ì„ ì¶•ì¡°í–ˆì–´ìš”!'},
    {id:10,type:'order',q:'ë‹¤ìŒ ê°œí™”ê¸° ì‚¬ê±´ì„ ìˆœì„œëŒ€ë¡œ ë°°ì—´í•˜ì„¸ìš”!',items:['ê°•í™”ë„ì¡°ì•½','ì„ì˜¤êµ°ë€','ê°‘ì‹ ì •ë³€','ê°‘ì˜¤ë†ë¯¼ìš´ë™'],correctOrder:[0,1,2,3],person:'kim_ok_gyun',explain:'1876ë…„ ê°•í™”ë„ì¡°ì•½ â†’ 1882ë…„ ì„ì˜¤êµ°ë€ â†’ 1884ë…„ ê°‘ì‹ ì •ë³€ â†’ 1894ë…„ ê°‘ì˜¤ë†ë¯¼ìš´ë™'},
    {id:11,type:'ox',q:'ì¡°ì„  í›„ê¸°ì—ëŠ” ìƒì—…ì´ ë°œë‹¬í–ˆë‹¤.',answer:true,person:'park_ji_won',explain:'ì¡°ì„  í›„ê¸°ì—ëŠ” ìƒì—…ê³¼ ìˆ˜ê³µì—…ì´ í¬ê²Œ ë°œë‹¬í–ˆì–´ìš”!'},
    {id:12,type:'4choice',q:'ëŒ€ì›êµ°ì´ ì² ê±°í•œ ê²ƒì€?',options:['í–¥êµ','ì„œë‹¹','ì„œì›','ì„±ê· ê´€'],answer:2,person:'heungseon',explain:'í¥ì„ ëŒ€ì›êµ°ì´ ì „êµ­ì˜ ì„œì›ì„ ëŒ€ê±° ì² ê±°í–ˆì–´ìš”!'}
  ],
  modern: [
    {id:1,type:'4choice',q:'ì´í†  íˆë¡œë¶€ë¯¸ë¥¼ ì²˜ë‹¨í•œ ì˜ì‚¬ëŠ”?',options:['ì•ˆì¤‘ê·¼','ìœ¤ë´‰ê¸¸','ì´ë´‰ì°½','ê¹€ìƒì˜¥'],answer:0,person:'an_jung_geun',explain:'ì•ˆì¤‘ê·¼ ì˜ì‚¬ê°€ í•˜ì–¼ë¹ˆì—ì„œ ì´í†  íˆë¡œë¶€ë¯¸ë¥¼ ì €ê²©í–ˆì–´ìš”!'},
    {id:2,type:'4choice',q:'3.1ìš´ë™ì˜ ìƒì§•ì  ì¸ë¬¼ì¸ ì—¬í•™ìƒì€?',options:['ê¹€ë§ˆë¦¬ì•„','ìœ ê´€ìˆœ','ë‚˜í˜œì„','ê¹€ì›ì£¼'],answer:1,person:'yu_gwan_sun',explain:'ìœ ê´€ìˆœì€ ì•„ìš°ë‚´ ì¥í„°ì—ì„œ ë§Œì„¸ìš´ë™ì„ ì£¼ë„í•œ ì—´ì‚¬ì˜ˆìš”!'},
    {id:3,type:'4choice',q:'ëŒ€í•œë¯¼êµ­ ì„ì‹œì •ë¶€ ì£¼ì„ì€?',options:['ê¹€êµ¬','ì´ìŠ¹ë§Œ','ì•ˆì°½í˜¸','ì‹ ì±„í˜¸'],answer:0,person:'kim_gu',explain:'ë°±ë²” ê¹€êµ¬ê°€ ëŒ€í•œë¯¼êµ­ ì„ì‹œì •ë¶€ ì£¼ì„ì„ ì§€ëƒˆì–´ìš”!'},
    {id:4,type:'ox',q:'ëŒ€í•œë¯¼êµ­ ì •ë¶€ìˆ˜ë¦½ì€ 1945ë…„ì´ë‹¤.',answer:false,person:'syngman_rhee',explain:'ëŒ€í•œë¯¼êµ­ ì •ë¶€ìˆ˜ë¦½ì€ 1948ë…„ 8ì›” 15ì¼ì´ì—ìš”!'},
    {id:5,type:'4choice',q:'ëŒ€í•œë¯¼êµ­ ì´ˆëŒ€ ëŒ€í†µë ¹ì€?',options:['ì´ìŠ¹ë§Œ','ê¹€êµ¬','ì•ˆì°½í˜¸','ì—¬ìš´í˜•'],answer:0,person:'syngman_rhee',explain:'ì´ìŠ¹ë§Œì´ ëŒ€í•œë¯¼êµ­ ì´ˆëŒ€ ëŒ€í†µë ¹ì´ ë˜ì—ˆì–´ìš”!'},
    {id:6,type:'4choice',q:'ê²½ì œê°œë°œ 5ê°œë…„ê³„íšì„ ì‹¤ì‹œí•œ ëŒ€í†µë ¹ì€?',options:['ì´ìŠ¹ë§Œ','ë°•ì •í¬','ì „ë‘í™˜','ê¹€ì˜ì‚¼'],answer:1,person:'park_chung_hee',explain:'ë°•ì •í¬ ëŒ€í†µë ¹ì´ ê²½ì œê°œë°œê³„íšìœ¼ë¡œ í•œê°•ì˜ ê¸°ì ì„ ì´ë¤˜ì–´ìš”!'},
    {id:7,type:'fill',q:'6.25ì „ìŸì´ ì¼ì–´ë‚œ í•´ëŠ” â—‹â—‹â—‹â—‹ë…„ì´ì—ìš”.',answer:['1950'],person:'syngman_rhee',explain:'1950ë…„ 6ì›” 25ì¼ì— ë¶í•œì´ ë‚¨ì¹¨í•˜ë©´ì„œ 6.25ì „ìŸì´ ì‹œì‘ëì–´ìš”!'},
    {id:8,type:'ox',q:'ê´‘ë³µì ˆì€ 8ì›” 15ì¼ì´ë‹¤.',answer:true,person:'kim_gu',explain:'1945ë…„ 8ì›” 15ì¼ ê´‘ë³µì ˆì— ì¼ì œê°•ì ê¸°ê°€ ëë‚¬ì–´ìš”!'},
    {id:9,type:'4choice',q:'4.19 í˜ëª…ì´ ì¼ì–´ë‚œ í•´ëŠ”?',options:['1948','1950','1960','1961'],answer:2,person:'syngman_rhee',explain:'1960ë…„ 4ì›” 19ì¼ í•™ìƒë“¤ì´ ì´ìŠ¹ë§Œ ì •ê¶Œì— ë§ì„œ ì¼ì–´ë‚¬ì–´ìš”!'},
    {id:10,type:'order',q:'ë‹¤ìŒ ì‚¬ê±´ì„ ì‹œê°„ ìˆœìœ¼ë¡œ ë°°ì—´í•˜ì„¸ìš”!',items:['ê´‘ë³µ','ì •ë¶€ìˆ˜ë¦½','6.25ì „ìŸ','4.19í˜ëª…'],correctOrder:[0,1,2,3],person:'kim_gu',explain:'1945ë…„ ê´‘ë³µ â†’ 1948ë…„ ì •ë¶€ìˆ˜ë¦½ â†’ 1950ë…„ 6.25ì „ìŸ â†’ 1960ë…„ 4.19í˜ëª…'},
    {id:11,type:'ox',q:'88ì˜¬ë¦¼í”½ì€ ì„œìš¸ì—ì„œ ì—´ë ¸ë‹¤.',answer:true,person:'park_chung_hee',explain:'1988ë…„ ì„œìš¸ì˜¬ë¦¼í”½ì´ ì„±ê³µì ìœ¼ë¡œ ê°œìµœë˜ì—ˆì–´ìš”!'},
    {id:12,type:'4choice',q:'ì¼ì œê°•ì ê¸°ê°€ ì‹œì‘ëœ í•´ëŠ”?',options:['1905','1910','1919','1945'],answer:1,person:'an_jung_geun',explain:'1910ë…„ í•œì¼ê°•ì œë³‘í•©ìœ¼ë¡œ ì¼ì œê°•ì ê¸°ê°€ ì‹œì‘ë˜ì—ˆì–´ìš”!'}
  ]
};

const TITLES = [
  {level:1,title:'ì—­ì‚¬ ìƒˆì‹¹ ğŸŒ±'},
  {level:3,title:'ì—­ì‚¬ íƒí—˜ê°€ ğŸ”'},
  {level:5,title:'ì‹œê°„ ëª¨í—˜ê°€ âš¡'},
  {level:8,title:'ì—­ì‚¬ ë°•ì‚¬ ğŸ“'},
  {level:12,title:'íƒ€ì„ë§ˆìŠ¤í„° ğŸŒŸ'},
  {level:15,title:'ì—­ì‚¬ì™• ğŸ‘‘'},
  {level:20,title:'ì‹œê³µì˜ í˜„ì âœ¨'}
];

// ==================== STATE ====================
let save = JSON.parse(localStorage.getItem('kh_save_v2')) || {
  level:1, xp:0, totalStars:0, nickname:'',
  collected:[], wrongNotes:[], stageStars:{}, stageProgress:{},
  rankings:{total:[],exam:[],stage:[]}, lastStage:'', examRecord:[]
};

let quiz = {
  questions:[], current:0, stars:0, score:0, newPersons:[], timer:null, timeLeft:15,
  isExam:false, mode:'normal', combo:0, totalTime:0, stage:''
};

function saveSave(){
  // Convert to v2 format if needed
  localStorage.removeItem('kh_save'); // Remove old save
  localStorage.setItem('kh_save_v2',JSON.stringify(save));
}

// ==================== SOUND EFFECTS ====================
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx = null;
function getAudio(){ if(!audioCtx) audioCtx=new AudioCtx(); return audioCtx; }

function playSound(type){
  try{
    const ctx=getAudio();
    const g=ctx.createGain();
    g.connect(ctx.destination);
    g.gain.value=0.3;
    const o=ctx.createOscillator();
    o.connect(g);
    
    if(type==='correct'){
      // ë°ì€ ë‘ ìŒ (ë„-ë¯¸)
      o.type='sine';
      o.frequency.setValueAtTime(523,ctx.currentTime);
      o.frequency.setValueAtTime(659,ctx.currentTime+0.1);
      g.gain.setValueAtTime(0.3,ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.3);
      o.start(ctx.currentTime);
      o.stop(ctx.currentTime+0.3);
    } else if(type==='wrong'){
      // ë‚®ì€ ë²„ì €ìŒ
      o.type='square';
      o.frequency.setValueAtTime(200,ctx.currentTime);
      o.frequency.setValueAtTime(150,ctx.currentTime+0.15);
      g.gain.setValueAtTime(0.2,ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.35);
      o.start(ctx.currentTime);
      o.stop(ctx.currentTime+0.35);
    } else if(type==='levelup'){
      // ìƒìŠ¹ ì•„ë¥´í˜ì§€ì˜¤ (ë„-ë¯¸-ì†”-ë„)
      const notes=[523,659,784,1047];
      notes.forEach((freq,i)=>{
        const oo=ctx.createOscillator();
        const gg=ctx.createGain();
        oo.connect(gg); gg.connect(ctx.destination);
        oo.type='sine';
        oo.frequency.value=freq;
        gg.gain.setValueAtTime(0.25,ctx.currentTime+i*0.12);
        gg.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+i*0.12+0.3);
        oo.start(ctx.currentTime+i*0.12);
        oo.stop(ctx.currentTime+i*0.12+0.3);
      });
      return;
    } else if(type==='star'){
      // ë°˜ì§ íš¨ê³¼ìŒ
      o.type='sine';
      o.frequency.setValueAtTime(880,ctx.currentTime);
      o.frequency.setValueAtTime(1100,ctx.currentTime+0.05);
      o.frequency.setValueAtTime(1320,ctx.currentTime+0.1);
      g.gain.setValueAtTime(0.2,ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.2);
      o.start(ctx.currentTime);
      o.stop(ctx.currentTime+0.2);
    } else if(type==='combo'){
      // ì½¤ë³´ íš¨ê³¼ (ë¹ ë¥¸ ìƒìŠ¹ìŒ)
      o.type='sawtooth';
      o.frequency.setValueAtTime(400,ctx.currentTime);
      o.frequency.exponentialRampToValueAtTime(1200,ctx.currentTime+0.15);
      g.gain.setValueAtTime(0.15,ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.2);
      o.start(ctx.currentTime);
      o.stop(ctx.currentTime+0.2);
    } else if(type==='click'){
      // í´ë¦­ìŒ
      o.type='sine';
      o.frequency.value=800;
      g.gain.setValueAtTime(0.15,ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.05);
      o.start(ctx.currentTime);
      o.stop(ctx.currentTime+0.05);
    } else if(type==='timeout'){
      // ì‹œê°„ì´ˆê³¼
      o.type='triangle';
      o.frequency.setValueAtTime(300,ctx.currentTime);
      o.frequency.setValueAtTime(200,ctx.currentTime+0.2);
      g.gain.setValueAtTime(0.25,ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.4);
      o.start(ctx.currentTime);
      o.stop(ctx.currentTime+0.4);
    } else if(type==='complete'){
      // ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ íŒ¡íŒŒë ˆ
      const melody=[523,659,784,1047,784,1047];
      melody.forEach((freq,i)=>{
        const oo=ctx.createOscillator();
        const gg=ctx.createGain();
        oo.connect(gg); gg.connect(ctx.destination);
        oo.type='sine';
        oo.frequency.value=freq;
        gg.gain.setValueAtTime(0.25,ctx.currentTime+i*0.15);
        gg.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+i*0.15+0.25);
        oo.start(ctx.currentTime+i*0.15);
        oo.stop(ctx.currentTime+i*0.15+0.25);
      });
      return;
    }
  } catch(e){}
}

// ==================== UTILITIES ====================
function shuffle(arr){
  const a=[...arr];
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function getTitle(lv){
  let t=TITLES[0].title;
  for(const ti of TITLES) if(lv>=ti.level) t=ti.title;
  return t;
}

function getTotalProgress(){
  const totalStages=STAGES.length;
  const completedStages=STAGES.filter(s=>save.stageStars[s.id]>0).length;
  return Math.round(completedStages/totalStages*100);
}

function getTotalStars(){
  return Object.values(save.stageStars).reduce((sum,stars)=>sum+stars,0);
}

// ==================== EFFECTS ====================
function createStarEffect(){
  const container=document.getElementById('effect-stars');
  for(let i=0;i<8;i++){
    const star=document.createElement('div');
    star.className='falling-star';
    star.textContent='â­';
    star.style.left=Math.random()*100+'%';
    star.style.animationDelay=i*0.2+'s';
    container.appendChild(star);
    setTimeout(()=>star.remove(),2500);
  }
}

function createCelebrationEmoji(emoji){
  const cel=document.createElement('div');
  cel.className='celebration-emoji';
  cel.textContent=emoji;
  cel.style.left=Math.random()*80+10+'%';
  cel.style.top=Math.random()*60+20+'%';
  document.body.appendChild(cel);
  setTimeout(()=>cel.remove(),1500);
}

function showCombo(count){
  const combo=document.getElementById('combo-counter');
  combo.textContent=`ğŸ”¥ ì½¤ë³´ x${count}`;
  combo.style.display='block';
  setTimeout(()=>combo.style.display='none',1500);
}

// ==================== SCREENS ====================
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  
  if(id==='main-screen') updateMainScreen();
  if(id==='stage-screen') renderStages();
  if(id==='collection-screen') renderCollection();
  if(id==='wrong-screen') renderWrongNotes();
  if(id==='ranking-screen') renderRankings();
}

function updateMainScreen(){
  const info=document.getElementById('main-player-info');
  const stats=document.getElementById('progress-stats');
  
  if(save.level>0){
    info.style.display='flex';
    stats.style.display='flex';
    document.getElementById('main-level').textContent='Lv.'+save.level;
    document.getElementById('main-title').textContent=getTitle(save.level);
    document.getElementById('main-stars').textContent=getTotalStars();
    document.getElementById('total-progress').textContent=getTotalProgress()+'%';
    document.getElementById('total-stars-count').textContent=getTotalStars();
  }
}

function renderStages(){
  const map=document.getElementById('stage-map');
  map.innerHTML='';
  
  STAGES.forEach((stage,i)=>{
    const isUnlocked=i===0||save.stageStars[STAGES[i-1].id]>0;
    const stars=save.stageStars[stage.id]||0;
    const progress=save.stageProgress[stage.id]||0;
    const maxStars=stage.maxQuestions*3;
    
    let starDisplay='';
    if(isUnlocked&&stars>0){
      const starCount=Math.min(3,Math.ceil(stars/(maxStars/3)));
      starDisplay='â­'.repeat(starCount);
    }
    
    const cardClass=['stage-card'];
    if(!isUnlocked) cardClass.push('locked');
    if(stars>0) cardClass.push('completed');
    
    const stageHtml=`
      <div class="${cardClass.join(' ')}" onclick="${isUnlocked?`startQuiz('${stage.id}')`:''}">
        <div class="stage-icon">${stage.emoji}</div>
        <div class="stage-info">
          <h3>${stage.name}</h3>
          <p>${stage.desc}</p>
          <div class="stage-stats">
            ${starDisplay?`<span class="stage-stars">${starDisplay}</span>`:''}
            ${progress>0?`<span class="stage-progress">${progress}/${stage.maxQuestions} ì™„ë£Œ</span>`:''}
          </div>
        </div>
        ${isUnlocked?'':'<div class="stage-lock">ğŸ”’</div>'}
      </div>`;
    
    map.innerHTML+=stageHtml;
    if(i<STAGES.length-1){
      map.innerHTML+=`<div class="stage-connector ${isUnlocked?'':'locked'}"></div>`;
    }
  });
  
  // Update stage unlock status
  STAGES.forEach((stage,i)=>{
    stage.unlocked=i===0||save.stageStars[STAGES[i-1].id]>0;
  });
}

// ==================== QUIZ SYSTEM ====================
function startQuiz(stageId){
  save.lastStage=stageId;
  const stageQuestions=QUESTIONS[stageId]||[];
  if(!stageQuestions.length) return;
  
  quiz={
    questions:shuffle([...stageQuestions]),
    current:0,stars:0,score:0,newPersons:[],timer:null,timeLeft:15,
    isExam:false,mode:'normal',combo:0,totalTime:0,stage:stageId
  };
  
  showScreen('quiz-screen');
  showQuestion();
}

function startExam(){
  // Collect all unlocked questions
  const allQuestions=[];
  STAGES.forEach(stage=>{
    if(stage.unlocked&&QUESTIONS[stage.id]){
      allQuestions.push(...QUESTIONS[stage.id]);
    }
  });
  
  if(allQuestions.length<20) return alert('ë” ë§ì€ ìŠ¤í…Œì´ì§€ë¥¼ í´ë¦¬ì–´í•´ì£¼ì„¸ìš”!');
  
  quiz={
    questions:shuffle(allQuestions).slice(0,20),
    current:0,stars:0,score:0,newPersons:[],timer:null,timeLeft:1200, // 20 minutes
    isExam:true,mode:'exam',combo:0,totalTime:1200,stage:'exam'
  };
  
  document.getElementById('quiz-screen').classList.add('exam-mode');
  showScreen('quiz-screen');
  showQuestion();
}

function showQuestion(){
  if(quiz.current>=quiz.questions.length){
    showResult();
    return;
  }
  
  const q=quiz.questions[quiz.current];
  const total=quiz.questions.length;
  
  document.getElementById('quiz-progress').textContent=`${quiz.current+1} / ${total}`;
  document.getElementById('progress-fill').style.width=(quiz.current/total*100)+'%';
  document.getElementById('quiz-question').textContent=q.q;
  
  const types={'4choice':'4ì§€ì„ ë‹¤','ox':'O/X í€´ì¦ˆ','order':'ìˆœì„œë§ì¶”ê¸°','fill':'ë¹ˆì¹¸ì±„ìš°ê¸°'};
  document.getElementById('quiz-type-badge').textContent=types[q.type]||'';
  
  const area=document.getElementById('quiz-options-area');
  area.innerHTML='';
  
  if(q.type==='4choice') renderChoiceQ(q,area);
  else if(q.type==='ox') renderOXQ(q,area);
  else if(q.type==='order') renderOrderQ(q,area);
  else if(q.type==='fill') renderFillQ(q,area);
  
  startTimer();
}

function startTimer(){
  clearInterval(quiz.timer);
  if(!quiz.isExam) quiz.timeLeft=15;
  updateTimerDisplay();
  
  quiz.timer=setInterval(()=>{
    quiz.timeLeft--;
    updateTimerDisplay();
    if(quiz.timeLeft<=0){
      clearInterval(quiz.timer);
      handleTimeout();
    }
  },1000);
}

function updateTimerDisplay(){
  const el=document.getElementById('quiz-timer');
  if(quiz.isExam){
    const minutes=Math.floor(quiz.timeLeft/60);
    const seconds=quiz.timeLeft%60;
    el.innerHTML=`â° ${minutes}:${seconds.toString().padStart(2,'0')}`;
    el.classList.toggle('exam-warning',quiz.timeLeft<=300); // 5 minutes warning
  } else {
    el.textContent='â± '+quiz.timeLeft;
    el.classList.toggle('warning',quiz.timeLeft<=5);
  }
}

function handleTimeout(){
  playSound('timeout');
  const q=quiz.questions[quiz.current];
  processAnswer(false,q,0);
}

// ==================== QUESTION TYPES ====================
function renderChoiceQ(q,area){
  const labels=['â‘ ','â‘¡','â‘¢','â‘£'];
  let html='<div class="quiz-options">';
  q.options.forEach((o,i)=>{
    html+=`<button class="option-btn" id="opt-${i}" onclick="selectChoice(${i})">
      <span class="option-label">${labels[i]}</span><span>${o}</span></button>`;
  });
  html+='</div>';
  area.innerHTML=html;
}

function selectChoice(i){
  clearInterval(quiz.timer);
  const q=quiz.questions[quiz.current];
  const correct=i===q.answer;
  
  document.querySelectorAll('.option-btn').forEach(b=>b.disabled=true);
  document.getElementById('opt-'+q.answer).classList.add('correct');
  if(!correct) document.getElementById('opt-'+i).classList.add('wrong');
  
  setTimeout(()=>processAnswer(correct,q,quiz.isExam?quiz.totalTime-quiz.timeLeft:quiz.timeLeft),800);
}

function renderOXQ(q,area){
  area.innerHTML=`<div class="ox-options">
    <button class="ox-btn" id="ox-o" onclick="selectOX(true)">â­•</button>
    <button class="ox-btn" id="ox-x" onclick="selectOX(false)">âŒ</button>
  </div>`;
}

function selectOX(val){
  clearInterval(quiz.timer);
  const q=quiz.questions[quiz.current];
  const correct=val===q.answer;
  
  document.querySelectorAll('.ox-btn').forEach(b=>b.style.pointerEvents='none');
  const correctId=q.answer?'ox-o':'ox-x';
  document.getElementById(correctId).classList.add('correct');
  if(!correct) document.getElementById(val?'ox-o':'ox-x').classList.add('wrong');
  
  setTimeout(()=>processAnswer(correct,q,quiz.isExam?quiz.totalTime-quiz.timeLeft:quiz.timeLeft),800);
}

function renderOrderQ(q,area){
  const shuffled=shuffle([...q.items.map((t,i)=>({text:t,origIdx:i}))]);
  area.innerHTML=`<div class="order-area">
    <div class="order-hint">ğŸ‘† ìˆœì„œëŒ€ë¡œ í´ë¦­í•´ì£¼ì„¸ìš”!</div>
    <div class="order-items" id="order-items">
      ${shuffled.map((item,i)=>`<div class="order-item" data-orig="${item.origIdx}" data-idx="${i}" onclick="selectOrderItem(this)">
        <span class="order-num">${i+1}</span><span>${item.text}</span>
      </div>`).join('')}
    </div>
    <button class="btn btn-primary btn-sm order-submit" id="order-submit" onclick="submitOrder()" disabled>í™•ì¸! âœ…</button>
  </div>`;
  window._orderSelected=[];
}

function selectOrderItem(el){
  if(el.classList.contains('selected-order')){
    el.classList.remove('selected-order');
    window._orderSelected=window._orderSelected.filter(e=>e!==el);
  } else {
    el.classList.add('selected-order');
    window._orderSelected.push(el);
  }
  
  // Update order numbers
  document.querySelectorAll('.order-item .order-num').forEach((n,i)=>{
    const item=n.parentElement;
    if(item.classList.contains('selected-order')){
      const pos=window._orderSelected.indexOf(item)+1;
      n.textContent='ğŸ”¢'+pos;
    } else {
      n.textContent=i+1;
    }
  });
  
  document.getElementById('order-submit').disabled=window._orderSelected.length!==document.querySelectorAll('.order-item').length;
}

function submitOrder(){
  clearInterval(quiz.timer);
  const q=quiz.questions[quiz.current];
  const userOrder=window._orderSelected.map(el=>parseInt(el.dataset.orig));
  const correct=JSON.stringify(userOrder)===JSON.stringify(q.correctOrder);
  processAnswer(correct,q,quiz.isExam?quiz.totalTime-quiz.timeLeft:quiz.timeLeft);
}

function renderFillQ(q,area){
  area.innerHTML=`<div class="fill-area">
    <input type="text" class="fill-input" id="fill-input" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
    <div class="fill-hint">ğŸ’¡ íŒíŠ¸: ${q.answer[0].length}ê¸€ì</div>
    <button class="btn btn-primary btn-sm" onclick="submitFill()">í™•ì¸! âœ…</button>
  </div>`;
  
  document.getElementById('fill-input').addEventListener('keydown',e=>{
    if(e.key==='Enter') submitFill();
  });
  document.getElementById('fill-input').focus();
}

function submitFill(){
  clearInterval(quiz.timer);
  const q=quiz.questions[quiz.current];
  const val=document.getElementById('fill-input').value.trim();
  const correct=q.answer.some(a=>val===a);
  processAnswer(correct,q,quiz.isExam?quiz.totalTime-quiz.timeLeft:quiz.timeLeft);
}

// ==================== ANSWER PROCESSING ====================
function processAnswer(correct,q,timeSpent){
  let earnedStars=0;
  
  if(correct){
    quiz.score++;
    quiz.combo++;
    playSound('correct');
    
    if(quiz.isExam){
      earnedStars=1;
    } else {
      if(timeSpent>=10) earnedStars=3;
      else if(timeSpent>=5) earnedStars=2;
      else earnedStars=1;
    }
    
    quiz.stars+=earnedStars;
    setTimeout(()=>playSound('star'),200);
    
    // Show combo effect
    if(quiz.combo>=3){
      showCombo(quiz.combo);
      createCelebrationEmoji('ğŸ”¥');
      playSound('combo');
    }
    
    // Collect person
    if(q.person&&!save.collected.includes(q.person)){
      save.collected.push(q.person);
      quiz.newPersons.push(q.person);
    }
  } else {
    quiz.combo=0;
    playSound('wrong');
    
    // Add to wrong notes
    const existing=save.wrongNotes.find(w=>w.id===q.id);
    if(!existing){
      save.wrongNotes.push({
        id:q.id,q:q.q,type:q.type,stage:quiz.stage,
        correctAnswer:getCorrectAnswerText(q),
        explain:q.explain
      });
    }
  }
  
  saveSave();
  showFeedback(correct,q,earnedStars);
}

function getCorrectAnswerText(q){
  if(q.type==='4choice') return q.options[q.answer];
  if(q.type==='ox') return q.answer?'O':'X';
  if(q.type==='fill') return q.answer[0];
  if(q.type==='order') return 'ì˜¬ë°”ë¥¸ ìˆœì„œëŒ€ë¡œ';
  return '';
}

function showFeedback(correct,q,stars){
  const overlay=document.getElementById('feedback-overlay');
  const card=document.getElementById('feedback-card');
  const person=q.person?PERSONS[q.person]:null;
  const isNew=quiz.newPersons.includes(q.person);
  
  // Create star effect if correct
  if(correct){
    createStarEffect();
    if(stars===3) createCelebrationEmoji('ğŸŒŸ');
  }
  
  let starsHtml='';
  if(correct&&!quiz.isExam){
    for(let i=0;i<3;i++){
      starsHtml+=`<span style="animation-delay:${i*0.2}s">${i<stars?'â­':'â˜†'}</span>`;
    }
  }
  
  card.innerHTML=`
    <div class="feedback-emoji">${correct?'ğŸ‰':'ğŸ˜¢'}</div>
    <div class="feedback-title">${correct?'ì •ë‹µì´ì—ìš”!':'ì•„ì‰¬ì›Œìš”...'}</div>
    <div class="feedback-desc">${q.explain}</div>
    ${correct&&!quiz.isExam?`<div class="feedback-stars">${starsHtml}</div>`:''}
    ${correct&&isNew&&person?`<div class="person-card-mini">ğŸ†• ${person.emoji} <b>${person.name}</b> ìˆ˜ì§‘!</div>`:''}
    <button class="btn btn-sm ${correct?'btn-secondary':'btn-primary'}" onclick="closeFeedbackAndNext()">
      ${quiz.current<quiz.questions.length-1?'ë‹¤ìŒ ë¬¸ì œ â†’':'ê²°ê³¼ ë³´ê¸° ğŸ†'}
    </button>`;
  
  overlay.style.display='flex';
}

function closeFeedbackAndNext(){
  document.getElementById('feedback-overlay').style.display='none';
  quiz.current++;
  showQuestion();
}

// ==================== RESULTS ====================
function showResult(){
  clearInterval(quiz.timer);
  document.getElementById('quiz-screen').classList.remove('exam-mode');
  
  const total=quiz.questions.length;
  const pct=Math.round(quiz.score/total*100);
  
  // Calculate XP gain
  let xpGain=quiz.score*10;
  if(!quiz.isExam) xpGain+=quiz.stars*2;
  
  const oldLevel=save.level;
  save.xp+=xpGain;
  save.level=Math.max(1,Math.floor(save.xp/50)+1);
  save.totalStars+=quiz.stars;
  
  if(!quiz.isExam){
    // Update stage progress
    save.stageStars[quiz.stage]=Math.max(save.stageStars[quiz.stage]||0,quiz.stars);
    save.stageProgress[quiz.stage]=Math.max(save.stageProgress[quiz.stage]||0,quiz.score);
  } else {
    // Record exam result
    const examResult={
      score:quiz.score,
      total:total,
      percentage:pct,
      date:new Date().toISOString().split('T')[0],
      nickname:save.nickname||'ìµëª…'
    };
    save.examRecord.push(examResult);
    updateRanking('exam',examResult);
  }
  
  const leveledUp=save.level>oldLevel;
  saveSave();
  playSound('complete');
  if(leveledUp) setTimeout(()=>playSound('levelup'),500);
  
  // Update UI
  const resultHeader=quiz.isExam?'ğŸ“':'ğŸ‰';
  const resultTitle=quiz.isExam?'ëª¨ì˜ì‹œí—˜ ì™„ë£Œ!':
    pct>=70?`${STAGES.find(s=>s.id===quiz.stage)?.name} í´ë¦¬ì–´!`:'ë‹¤ì‹œ ë„ì „í•´ë³´ì!';
  
  document.getElementById('result-header').textContent=resultHeader;
  document.getElementById('result-title').textContent=resultTitle;
  
  // Level up banner
  document.getElementById('level-up-area').innerHTML=leveledUp?
    `<div class="level-up-banner">ğŸ†™ ë ˆë²¨ ì—…! Lv.${save.level} ${getTitle(save.level)}</div>`:'';
  
  // Grade prediction for exam
  let gradeArea='';
  if(quiz.isExam){
    let grade='ë” ê³µë¶€ê°€ í•„ìš”í•´ìš” âœŠ';
    if(pct>=90) grade='6ê¸‰ í•©ê²© ì˜ˆìƒ! ğŸ†';
    else if(pct>=75) grade='7ê¸‰ ìˆ˜ì¤€ ğŸ’ª';
    else if(pct>=60) grade='8ê¸‰ ìˆ˜ì¤€ ğŸ“š';
    gradeArea=`<div class="grade-prediction">${grade}</div>`;
  }
  document.getElementById('grade-area').innerHTML=gradeArea;
  
  // Stats
  const statsHtml=quiz.isExam?`
    <div class="result-stat"><div class="stat-value">${quiz.score}/${total}</div><div class="stat-label">ì •ë‹µ</div></div>
    <div class="result-stat"><div class="stat-value">${pct}%</div><div class="stat-label">ì •ë‹µë¥ </div></div>
    <div class="result-stat"><div class="stat-value">+${xpGain}</div><div class="stat-label">ê²½í—˜ì¹˜</div></div>
    <div class="result-stat"><div class="stat-value">Lv.${save.level}</div><div class="stat-label">ë ˆë²¨</div></div>`:`
    <div class="result-stat"><div class="stat-value">${quiz.score}/${total}</div><div class="stat-label">ì •ë‹µ</div></div>
    <div class="result-stat"><div class="stat-value" style="color:var(--star)">â­${quiz.stars}</div><div class="stat-label">ë³„</div></div>
    <div class="result-stat"><div class="stat-value">${pct}%</div><div class="stat-label">ì •ë‹µë¥ </div></div>
    <div class="result-stat"><div class="stat-value">+${xpGain}</div><div class="stat-label">ê²½í—˜ì¹˜</div></div>`;
  
  document.getElementById('result-summary').innerHTML=statsHtml;
  
  // New persons
  const cardsArea=document.getElementById('result-cards-area');
  if(quiz.newPersons.length>0){
    cardsArea.innerHTML='<p style="font-weight:700;margin:12px 0 8px;color:var(--primary)">ğŸ†• ìƒˆë¡œ ìˆ˜ì§‘í•œ ì¸ë¬¼</p><div class="result-cards">'+
      quiz.newPersons.map(pid=>{
        const p=PERSONS[pid];
        return`<div class="result-person"><div class="rp-emoji">${p.emoji}</div><div>${p.name}</div></div>`;
      }).join('')+'</div>';
  } else {
    cardsArea.innerHTML='';
  }
  
  // Buttons
  const btnsArea=document.getElementById('result-btns');
  if(quiz.isExam){
    btnsArea.innerHTML=`
      <button class="btn btn-primary" onclick="startExam()">ğŸ”„ ë‹¤ì‹œ ë„ì „</button>
      <button class="btn btn-secondary" onclick="showScreen('ranking-screen')">ğŸ† ë­í‚¹ ë³´ê¸°</button>
      <button class="btn btn-outline" onclick="showScreen('main-screen')">ğŸ  ë©”ì¸ìœ¼ë¡œ</button>`;
  } else {
    btnsArea.innerHTML=`
      <button class="btn btn-primary" onclick="retryCurrentStage()">ğŸ”„ ë‹¤ì‹œ ë„ì „</button>
      <button class="btn btn-secondary" onclick="showScreen('stage-screen')">ğŸ“ ë‹¤ë¥¸ ì‹œëŒ€</button>
      <button class="btn btn-outline" onclick="showScreen('main-screen')">ğŸ  ë©”ì¸ìœ¼ë¡œ</button>`;
  }
  
  document.getElementById('progress-fill').style.width='100%';
  showScreen('result-screen');
}

function retryCurrentStage(){
  if(save.lastStage) startQuiz(save.lastStage);
  else showScreen('stage-screen');
}

// ==================== COLLECTION ====================
function renderCollection(){
  const grid=document.getElementById('collection-grid');
  const allKeys=Object.keys(PERSONS);
  
  document.getElementById('collection-count').textContent=`${save.collected.length} / ${allKeys.length} ìˆ˜ì§‘`;
  grid.innerHTML='';
  
  // Group by era
  const eras=['ê³ ì¡°ì„ ','ì„ ì‚¬ì‹œëŒ€','ì² ê¸°ì‹œëŒ€','ìœ„ë§Œì¡°ì„ ','ê³ êµ¬ë ¤','ë°±ì œ','ì‹ ë¼','í†µì¼ì‹ ë¼','ë°œí•´','ê³ ë ¤','ì¡°ì„ ','ì¡°ì„  í›„ê¸°','ì‹¤í•™','ê°œí™”ê¸°','ì¼ì œê°•ì ê¸°','í˜„ëŒ€'];
  
  allKeys.forEach(key=>{
    const p=PERSONS[key];
    const has=save.collected.includes(key);
    
    grid.innerHTML+=`<div class="person-card ${has?'':'locked'}" onclick="${has?`showPersonDetail('${key}')`:''}">
      <div class="pc-emoji">${has?p.emoji:'â“'}</div>
      <div class="pc-name">${has?p.name:'???'}</div>
      ${has?`<div class="pc-desc">${p.desc}</div><div class="pc-era">${p.era}</div>`:`<div class="pc-desc">???</div>`}
    </div>`;
  });
}

function showPersonDetail(key){
  const p=PERSONS[key];
  const overlay=document.getElementById('person-detail-overlay');
  
  document.getElementById('person-detail-content').innerHTML=`
    <div class="pd-emoji">${p.emoji}</div>
    <div class="pd-name">${p.name}</div>
    <div class="pc-era" style="margin:8px auto;display:inline-block">${p.era}</div>
    <div class="pd-info" style="margin-top:12px">${p.detail}</div>`;
  
  overlay.style.display='flex';
}

function hidePersonDetail(){
  document.getElementById('person-detail-overlay').style.display='none';
}

// ==================== RANKINGS ====================
function updateRanking(type,record){
  if(!save.nickname) return;
  
  const ranking=save.rankings[type];
  const existingIndex=ranking.findIndex(r=>r.nickname===save.nickname);
  
  if(existingIndex>=0){
    if(type==='exam'&&record.score>ranking[existingIndex].score){
      ranking[existingIndex]=record;
    }
  } else {
    ranking.push(record);
  }
  
  // Sort and limit
  ranking.sort((a,b)=>b.score-a.score);
  save.rankings[type]=ranking.slice(0,10);
}

function saveNickname(){
  const input=document.getElementById('nickname-input');
  const nickname=input.value.trim();
  if(!nickname) return;
  
  save.nickname=nickname;
  saveSave();
  
  // Update total ranking
  updateRanking('total',{
    nickname:nickname,
    level:save.level,
    totalStars:getTotalStars(),
    progress:getTotalProgress(),
    date:new Date().toISOString().split('T')[0]
  });
  
  input.value='';
  renderRankings();
}

function showRanking(type){
  document.querySelectorAll('.ranking-tab').forEach(t=>t.classList.remove('active'));
  event.target.classList.add('active');
  
  const list=document.getElementById('ranking-list');
  const rankings=save.rankings[type]||[];
  
  if(rankings.length===0){
    list.innerHTML='<div class="empty-state"><span class="empty-emoji">ğŸ†</span>ì•„ì§ ë­í‚¹ì´ ì—†ì–´ìš”!<br>ì²« ë²ˆì§¸ê°€ ë˜ì–´ë³´ì„¸ìš”!</div>';
    return;
  }
  
  list.innerHTML=rankings.map((record,i)=>{
    let rankClass='normal';
    if(i===0) rankClass='gold';
    else if(i===1) rankClass='silver';  
    else if(i===2) rankClass='bronze';
    
    let scoreText='';
    if(type==='total') scoreText=`Lv.${record.level} â€¢ â­${record.totalStars}`;
    else if(type==='exam') scoreText=`${record.score}ì  (${record.percentage}%)`;
    else scoreText=`${record.score}ì `;
    
    return`<div class="ranking-item">
      <div class="ranking-rank ${rankClass}">${i+1}</div>
      <div class="ranking-info">
        <div class="ranking-name">${record.nickname}</div>
        <div class="ranking-score">${scoreText}</div>
      </div>
    </div>`;
  }).join('');
}

function renderRankings(){
  const input=document.getElementById('nickname-input');
  if(save.nickname) input.placeholder=`í˜„ì¬: ${save.nickname}`;
  showRanking('total');
}

// ==================== WRONG NOTES ====================
function renderWrongNotes(){
  const list=document.getElementById('wrong-list');
  const retryBtn=document.getElementById('retry-wrong-btn');
  const clearBtn=document.getElementById('clear-wrong-btn');
  
  if(save.wrongNotes.length===0){
    list.innerHTML='<div class="empty-state"><span class="empty-emoji">ğŸ‰</span>í‹€ë¦° ë¬¸ì œê°€ ì—†ì–´ìš”!<br>ì™„ë²½í•´ìš”!</div>';
    retryBtn.style.display='none';
    clearBtn.style.display='none';
    return;
  }
  
  retryBtn.style.display='';
  clearBtn.style.display='';
  
  list.innerHTML=save.wrongNotes.map(w=>`
    <div class="wrong-item">
      <div class="wq">${w.q}</div>
      <div class="wc">âœ… ì •ë‹µ: ${w.correctAnswer}</div>
      <div class="we">ğŸ’¡ ${w.explain}</div>
      <div style="font-size:.7rem;color:#b2bec3;margin-top:4px">${STAGES.find(s=>s.id===w.stage)?.name||'ì•Œ ìˆ˜ ì—†ìŒ'}</div>
    </div>`).join('');
}

function retryWrongQuestions(){
  const wrongIds=save.wrongNotes.map(w=>w.id);
  const allQuestions=[];
  
  Object.values(QUESTIONS).forEach(stageQuestions=>{
    stageQuestions.forEach(q=>{
      if(wrongIds.includes(q.id)) allQuestions.push(q);
    });
  });
  
  if(allQuestions.length===0) return;
  
  quiz={
    questions:shuffle(allQuestions),
    current:0,stars:0,score:0,newPersons:[],timer:null,timeLeft:15,
    isExam:false,mode:'retry',combo:0,totalTime:0,stage:'retry'
  };
  
  showScreen('quiz-screen');
  showQuestion();
}

function clearWrongNotes(){
  if(!confirm('ì˜¤ë‹µ ë…¸íŠ¸ë¥¼ ë¹„ìš¸ê¹Œìš”?')) return;
  save.wrongNotes=[];
  saveSave();
  renderWrongNotes();
}

// ==================== UTILITY FUNCTIONS ====================
function resetGame(){
  if(!confirm('ëª¨ë“  ì§„í–‰ìƒí™©ì„ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
  localStorage.removeItem('kh_save_v2');
  localStorage.removeItem('kh_save'); // Remove old version too
  location.reload();
}

// ==================== INITIALIZATION ====================
document.addEventListener('DOMContentLoaded',()=>{
  updateMainScreen();
  
  // Unlock first stage if needed
  if(!STAGES[0].unlocked){
    STAGES[0].unlocked=true;
    saveSave();
  }
  
  console.log('í•œêµ­ì‚¬ íƒ€ì„ì–´ë“œë²¤ì²˜ 2.0 ë¡œë“œ ì™„ë£Œ! ğŸ®');
});
</script>
</body>
</html>